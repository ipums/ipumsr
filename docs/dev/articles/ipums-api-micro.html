<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Microdata API Requests • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Microdata API Requests">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">IPUMS Data</li>
    <li>
      <a href="../articles/ipums-read.html">Read IPUMS data</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">IPUMS API</li>
    <li>
      <a href="../articles/ipums-api.html">Introduction to the API</a>
    </li>
    <li>
      <a href="../articles/ipums-api-micro.html">Microdata API requests</a>
    </li>
    <li>
      <a href="../articles/ipums-api-nhgis.html">NHGIS API requests</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="https://ipums.org/exercises.shtml" class="external-link">Project-specific exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipums/ipumsr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/" class="external-link">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Microdata API Requests</h1>
                        <h4 data-toc-skip class="author">Institute for
Social Research and Data Innovation</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/vignettes/ipums-api-micro.Rmd" class="external-link"><code>vignettes/ipums-api-micro.Rmd</code></a></small>
      <div class="hidden name"><code>ipums-api-micro.Rmd</code></div>

    </div>

    
    
<p>This vignette details the options available for requesting data from
IPUMS microdata projects via the IPUMS API.</p>
<p>If you haven’t yet learned the basics of the IPUMS API workflow, you
may want to start with the <a href="ipums-api.html">IPUMS API
introduction</a>. The code below assumes you have registered and set up
your API key as described there.</p>
<div class="section level2">
<h2 id="supported-microdata-collections">Supported microdata collections<a class="anchor" aria-label="anchor" href="#supported-microdata-collections"></a>
</h2>
<p>IPUMS provides several data collections that are classified as
microdata. Currently, the following microdata collections are supported
by the IPUMS API (shown with the codes used to refer to them in
ipumsr):</p>
<ul>
<li>IPUMS USA (<code>"usa"</code>)</li>
<li>IPUMS CPS (<code>"cps"</code>)</li>
<li>IPUMS International (<code>"ipumsi"</code>)</li>
</ul>
<p>API support will continue to be added for more collections in the
future. See the <a href="https://developer.ipums.org/docs/apiprogram/" class="external-link">API
documentation</a> for more information on upcoming additions to the
API.</p>
<p>In addition to microdata projects, the IPUMS API also supports IPUMS
NHGIS data. For details about obtaining IPUMS NHGIS data using ipumsr,
see the <a href="ipums-api-nhgis.html">NHGIS-specific vignette</a>.</p>
<p>Before getting started, we’ll load ipumsr and <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a>, which will be helpful for
this demo:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.ipums.org" class="external-link">ipumsr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-ipums-microdata-concepts">Basic IPUMS microdata concepts<a class="anchor" aria-label="anchor" href="#basic-ipums-microdata-concepts"></a>
</h2>
<p>Every microdata extract definition must contain a set of requested
<em>samples</em> and <em>variables</em>.</p>
<p>In an IPUMS microdata collection, a <em>sample</em> refers to a
distinct combination of records and variables. A record is a set of
values that describe the characteristics of a single unit of measurement
(e.g. a single person or a single household), and <em>variables</em>
define the characteristics that were measured.</p>
<p>A single sample can contain multiple record types (e.g. person
records, household records, or activity records, and more), each of
which correspond to different units of measurement.</p>
<p>Note that our usage of the term “sample” does not correspond
perfectly to the statistical sense of a subset of individuals from a
population. Many IPUMS samples are samples in the statistical sense, but
some are “full-count” samples, meaning they contain all individuals in a
population.</p>
</div>
<div class="section level2">
<h2 id="ipums-microdata-metadata-forthcoming">IPUMS microdata metadata (forthcoming)<a class="anchor" aria-label="anchor" href="#ipums-microdata-metadata-forthcoming"></a>
</h2>
<p>Of course, to request samples and variables, we have to know the
codes that the API uses to refer to them. For samples, the IPUMS API
uses special codes that don’t appear in the web-based extract builder.
For variables, the API uses the same variable names that appear on the
web.</p>
<p>While the IPUMS API does not yet provide a comprehensive set of
metadata endpoints for IPUMS microdata collections, users can use the
<code><a href="../reference/get_sample_info.html">get_sample_info()</a></code> function to identify the codes used to
refer to specific samples when communicating with the API.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cps_samps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_sample_info.html">get_sample_info</a></span><span class="op">(</span><span class="st">"cps"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cps_samps</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   name        description         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cps1962_03s IPUMS-CPS, ASEC 1962</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cps1963_03s IPUMS-CPS, ASEC 1963</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cps1964_03s IPUMS-CPS, ASEC 1964</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> cps1965_03s IPUMS-CPS, ASEC 1965</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> cps1966_03s IPUMS-CPS, ASEC 1966</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> cps1967_03s IPUMS-CPS, ASEC 1967</span></span></code></pre></div>
<p>The values listed in the <code>name</code> column correspond to the
code that you would use to request that sample when creating an extract
definition to be submitted to the IPUMS API.</p>
<p>We can use basic functions from dplyr to filter the metadata to
samples of interest. For instance, to find all IPUMS International
samples for Mexico, we could do the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ipumsi_samps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_sample_info.html">get_sample_info</a></span><span class="op">(</span><span class="st">"ipumsi"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ipumsi_samps</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Mexico"</span>, <span class="va">description</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 70 × 2</span></span></span>
<span><span class="co">#&gt;    name    description       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> mx1960a Mexico 1960       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> mx1970a Mexico 1970       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> mx1990a Mexico 1990       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> mx1995a Mexico 1995       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> mx2000a Mexico 2000       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> mx2005a Mexico 2005       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> mx2010a Mexico 2010       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> mx2015a Mexico 2015       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> mx2005h Mexico 2005 Q1 LFS</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> mx2005i Mexico 2005 Q2 LFS</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 60 more rows</span></span></span></code></pre></div>
<p>IPUMS intends to add support for accessing variable metadata via API
in the future. Until then, use the web-based extract builder for a given
collection to find variable names and availability by sample. See the <a href="https://developer.ipums.org/docs/v2/workflows/explore_metadata/microdata-hp/" class="external-link">IPUMS
API documentation</a> for links to the extract builder for each
microdata collection with API support.</p>
<p>Alternatively, if you have made an extract previously through the web
interface, you can use <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> to identify the
variable names it includes. See the <a href="ipums-api.html">IPUMS API
introduction</a> for more details.</p>
</div>
<div class="section level2">
<h2 id="defining-an-ipums-microdata-extract-request">Defining an IPUMS microdata extract request<a class="anchor" aria-label="anchor" href="#defining-an-ipums-microdata-extract-request"></a>
</h2>
<p>Each IPUMS collection has its own extract definition function that is
used to specify the parameters of a new extract request from scratch.
These functions take the form <code>define_extract_*()</code>. For
microdata collections, we have:</p>
<ul>
<li>IPUMS USA: <code><a href="../reference/define_extract-micro.html">define_extract_usa()</a></code>
</li>
<li>IPUMS CPS: <code><a href="../reference/define_extract-micro.html">define_extract_cps()</a></code>
</li>
<li>IPUMS International: <code><a href="../reference/define_extract-micro.html">define_extract_ipumsi()</a></code>
</li>
</ul>
<p>When you define an extract request, you can specify the data to be
included in the extract and indicate the desired format and layout.</p>
<p>While each microdata collection has its own extract definition
function, each uses the same syntax. The examples in this vignette use
multiple collections, but the syntax they demonstrate can be applied to
all of the supported microdata collections.</p>
<p>A simple extract definition needs only to contain the names of the
samples and variables to include in the request:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cps_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract-micro.html">define_extract_cps</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Example CPS extract"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps2018_03s"</span>, <span class="st">"cps2019_03s"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"RACE"</span>, <span class="st">"STATEFIP"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cps_ext</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS CPS extract </span></span>
<span><span class="co">#&gt; Description: Example CPS extract</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) cps2018_03s, cps2019_03s</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(4 total) AGE, SEX, RACE, STATEFIP</span></span></code></pre></div>
<p>This produces an <code>ipums_extract</code> object containing the
extract request specifications that is ready to be submitted to the
IPUMS API.</p>
<p>When you request a variable in your extract definition, the resulting
data extract will include that variable for all requested samples where
it is available. If you request a variable that is not available for any
requested samples, the IPUMS API will throw an informative error when
you try to submit your request.</p>
<p>Beyond just specifying samples and variables, there are several
additional options available to refine the data requested in a microdata
extract request.</p>
</div>
<div class="section level2">
<h2 id="detailed-variable-specifications">Detailed variable specifications<a class="anchor" aria-label="anchor" href="#detailed-variable-specifications"></a>
</h2>
<p>The IPUMS API supports several detailed specification options that
can be applied to individual variables in an extract request: case
selections, attached characteristics, and data quality flags.</p>
<p>Before we describe each of these options in depth, we’ll introduce
the syntax used to add them to your extract definition.</p>
<div class="section level3">
<h3 id="syntax">Syntax<a class="anchor" aria-label="anchor" href="#syntax"></a>
</h3>
<p>To add any of these options to a variable, we need to introduce the
<code><a href="../reference/var_spec.html">var_spec()</a></code> helper function.</p>
<p><code><a href="../reference/var_spec.html">var_spec()</a></code> bundles all the selections for a given
variable together into a single object (in this case, a
<code>var_spec</code> object):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"SEX"</span>, case_selections <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ name               : chr "SEX"</span></span>
<span><span class="co">#&gt;  $ case_selections    : chr "2"</span></span>
<span><span class="co">#&gt;  $ case_selection_type: chr "general"</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "var_spec" "ipums_spec" "list"</span></span></code></pre></div>
<p>To include this specification in our extract, we simply provide it to
the <code>variables</code> argument of our extract definition. When
multiple variables are included, pass a <code>list</code> of
<code>var_spec</code> objects:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract-micro.html">define_extract_cps</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Case selection example"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps2018_03s"</span>, <span class="st">"cps2019_03s"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"SEX"</span>, case_selections <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"AGE"</span>, attached_characteristics <span class="op">=</span> <span class="st">"head"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS CPS extract </span></span>
<span><span class="co">#&gt; Description: Case selection example</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) cps2018_03s, cps2019_03s</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(2 total) SEX, AGE</span></span></code></pre></div>
<p>In fact, if you investigate our original extract object from above,
you’ll notice that the variables have automatically been converted to
<code>var_spec</code> objects, even though they were provided as
character vectors:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cps_ext</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ AGE     :List of 1</span></span>
<span><span class="co">#&gt;   ..$ name: chr "AGE"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "var_spec" "ipums_spec" "list"</span></span>
<span><span class="co">#&gt;  $ SEX     :List of 1</span></span>
<span><span class="co">#&gt;   ..$ name: chr "SEX"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "var_spec" "ipums_spec" "list"</span></span>
<span><span class="co">#&gt;  $ RACE    :List of 1</span></span>
<span><span class="co">#&gt;   ..$ name: chr "RACE"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "var_spec" "ipums_spec" "list"</span></span>
<span><span class="co">#&gt;  $ STATEFIP:List of 1</span></span>
<span><span class="co">#&gt;   ..$ name: chr "STATEFIP"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "var_spec" "ipums_spec" "list"</span></span></code></pre></div>
<p>So, a <code>var_spec</code> object with no additional specifications
will produce the default data for a given variable. That is, the
following are equivalent:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract-micro.html">define_extract_cps</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Example CPS extract"</span>,</span>
<span>  samples <span class="op">=</span> <span class="st">"cps2018_03s"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"AGE"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/define_extract-micro.html">define_extract_cps</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Example CPS extract"</span>,</span>
<span>  samples <span class="op">=</span> <span class="st">"cps2018_03s"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Because all specified variables are converted to
<code>var_spec</code> objects, you can also pass a list where some
elements are <code>var_spec</code> objects and some are just variable
names. This is convenient when you only have detailed specifications for
a subset of variables:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract-micro.html">define_extract_cps</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Case selection example"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps2018_03s"</span>, <span class="st">"cps2019_03s"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"SEX"</span>, case_selections <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span>,</span>
<span>    <span class="st">"AGE"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS CPS extract </span></span>
<span><span class="co">#&gt; Description: Case selection example</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) cps2018_03s, cps2019_03s</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(2 total) SEX, AGE</span></span></code></pre></div>
<p>(Samples are also converted to their own <code>samp_spec</code>
objects, but as there currently aren’t any additional specifications
available for samples, there is no reason to use anything other than a
character vector in the <code>samples</code> argument.)</p>
<p>Now that we’ve covered the basic syntax for including detailed
variable specifications, we can describe the available options in more
depth.</p>
</div>
<div class="section level3">
<h3 id="case-selections">Case selections<a class="anchor" aria-label="anchor" href="#case-selections"></a>
</h3>
<p>Case selections allow us to limit the data to those records that
match a particular value on the specified variable.</p>
<p>For instance, the following specification would indicate that only
records with a value of <code>"27"</code> (Minnesota) or
<code>"19"</code> (Iowa) for the variable <code>"STATEFIP"</code> should
be included:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"STATEFIP"</span>, case_selections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"27"</span>, <span class="st">"19"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Some variables have versions with both general and detailed coding
schemes. By default, case selections are interpreted to refer to the
general codes:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span><span class="op">$</span><span class="va">case_selection_type</span></span>
<span><span class="co">#&gt; [1] "general"</span></span></code></pre></div>
<p>For variables with detailed versions, you can also select on the
detailed codes.</p>
<p>For instance, the IPUMS USA variable RACE is available in both
general and detailed versions. If you wanted to limit your extract to
persons identifying as “Two major races”, you could do so by specifying
a case selection of <code>"8"</code>. However, if you wanted to limit
your extract to only persons identifying as “White and Chinese” or
“White and Japanese”, you would need to specify <em>detailed</em> codes
<code>"811"</code> and <code>"812"</code>.</p>
<p>To include case selections for detailed codes, set
<code>case_selection_type = "detailed"</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># General case selection is the default</span></span>
<span><span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"RACE"</span>, case_selections <span class="op">=</span> <span class="st">"8"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "RACE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $case_selections</span></span>
<span><span class="co">#&gt; [1] "8"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $case_selection_type</span></span>
<span><span class="co">#&gt; [1] "general"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "var_spec"   "ipums_spec" "list"</span></span>
<span></span>
<span><span class="co"># For detailed case selection, change the `case_selection_type`</span></span>
<span><span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span></span>
<span>  <span class="st">"RACE"</span>, </span>
<span>  case_selections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"811"</span>, <span class="st">"812"</span><span class="op">)</span>, </span>
<span>  case_selection_type <span class="op">=</span> <span class="st">"detailed"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "RACE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $case_selections</span></span>
<span><span class="co">#&gt; [1] "811" "812"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $case_selection_type</span></span>
<span><span class="co">#&gt; [1] "detailed"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "var_spec"   "ipums_spec" "list"</span></span></code></pre></div>
<p>As noted above, IPUMS intends to add support for accessing variable
metadata via API in the future, such that users will be able to query
variable coding schemes right from their R sessions. Until then, use the
IPUMS web interface for a given collection to find general and detailed
variable codes for the purposes of case selection. See the <a href="https://developer.ipums.org/docs/v2/workflows/explore_metadata/microdata-hp/" class="external-link">IPUMS
API documentation</a> for relevant links.</p>
<p>By default, case selection on person-level variables produces a data
file that includes only those individuals who match the specified values
for the specified variables. It’s also possible to use case selection to
include matching individuals <em>and</em> all other members of their
households, using the <code>case_select_who</code> parameter.</p>
<p>The <code>case_select_who</code> parameter must be the same for all
case selections in an extract, and thus is set at the extract level
rather than the <code>var_spec</code> level. To include all household
members of matching individuals, set
<code>case_select_who = "households"</code> in the extract
definition:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract-micro.html">define_extract_usa</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Household level case selection"</span>,</span>
<span>  samples <span class="op">=</span> <span class="st">"us2021a"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"RACE"</span>, case_selections <span class="op">=</span> <span class="st">"8"</span><span class="op">)</span>,</span>
<span>  case_select_who <span class="op">=</span> <span class="st">"households"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS USA extract </span></span>
<span><span class="co">#&gt; Description: Household level case selection</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(1 total) us2021a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(1 total) RACE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="attached-characteristics">Attached characteristics<a class="anchor" aria-label="anchor" href="#attached-characteristics"></a>
</h3>
<p>IPUMS allows users to create variables that reflect the
characteristics of other household members. To do so, use the
<code>attached_characteristics</code> argument of
<code><a href="../reference/var_spec.html">var_spec()</a></code>.</p>
<p>For instance, to attach the spouse’s SEX value to a record:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"SEX"</span>, attached_characteristics <span class="op">=</span> <span class="st">"spouse"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "SEX"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $attached_characteristics</span></span>
<span><span class="co">#&gt; [1] "spouse"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "var_spec"   "ipums_spec" "list"</span></span></code></pre></div>
<p>This will add a new variable (in this case, SEX_SP) to the output
data that will contain the sex of a person’s spouse (if no such record
exists, the value will be 0).</p>
<p>Multiple attached characteristics can be attached for a single
variable:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"AGE"</span>, attached_characteristics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mother"</span>, <span class="st">"father"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "AGE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $attached_characteristics</span></span>
<span><span class="co">#&gt; [1] "mother" "father"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "var_spec"   "ipums_spec" "list"</span></span></code></pre></div>
<p>Acceptable values are <code>"spouse"</code>, <code>"mother"</code>,
<code>"father"</code>, and <code>"head"</code>.</p>
</div>
<div class="section level3">
<h3 id="data-quality-flags">Data quality flags<a class="anchor" aria-label="anchor" href="#data-quality-flags"></a>
</h3>
<p>Some variables in the IPUMS have been edited for missing, illegible,
and inconsistent values. Data quality flags indicate which values are
edited or allocated.</p>
<p>To include data quality flags for an individual variable, use the
<code>data_quality_flags</code> argument to <code><a href="../reference/var_spec.html">var_spec()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"RACE"</span>, data_quality_flags <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "RACE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data_quality_flags</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "var_spec"   "ipums_spec" "list"</span></span></code></pre></div>
<p>This will produce a new variable (QRACE) containing the data quality
flag for the given variable.</p>
<p>To add data quality flags for all variables that have them, set
<code>data_quality_flags = TRUE</code> in your extract definition
directly:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract-micro.html">define_extract_usa</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Data quality flags"</span>,</span>
<span>  samples <span class="op">=</span> <span class="st">"us2021a"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"RACE"</span>, case_selections <span class="op">=</span> <span class="st">"8"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/var_spec.html">var_spec</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data_quality_flags <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Each data quality flag corresponds to one or more variables, and the
codes for each flag vary based on the sample. See the documentation for
the IPUMS collection of interest for more information about data quality
flag codes.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-structure-and-file-format">Data structure and file format<a class="anchor" aria-label="anchor" href="#data-structure-and-file-format"></a>
</h2>
<p>By default, microdata extract definitions will request data in a
rectangular structure and fixed-width file format.</p>
<p>Rectangular data are data where only person records are included, and
any household-level variables are converted to person-level variables by
copying the values from the associated household record onto all
household members.</p>
<p>To instead create a hierarchical extract, which includes separate
records for households and persons, set
<code>data_structure = "hierarchical"</code> in your extract
definition.</p>
<p>See the <a href="ipums-read.html#hierarchical-extracts">IPUMS data
reading vignette</a> for more information about loading hierarchical
data into R.</p>
<p>To request a file format other than fixed-width, adjust the
<code>data_format</code> argument. Note that while you can request data
in a variety of formats (Stata, SPSS, etc.), ipumsr’s
<code><a href="../reference/read_ipums_micro.html">read_ipums_micro()</a></code> function only supports fixed-width and
csv files.</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>Once you have defined an extract request, you can submit the extract
for processing:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_submitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">usa_ext</span><span class="op">)</span></span></code></pre></div>
<p>The workflow for submitting and monitoring an extract request and
downloading its files when complete is described in the <a href="ipums-api.html">IPUMS API introduction</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> .</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
