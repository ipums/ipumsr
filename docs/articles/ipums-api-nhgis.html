<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ipumsr">
<title>NHGIS API Requests • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="NHGIS API Requests">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ipumsr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.7.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ipums.html">Get Started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>IPUMS Data</h6>
    <a class="dropdown-item" href="../articles/ipums-read.html">Read IPUMS data</a>
    <a class="dropdown-item" href="../articles/value-labels.html">Value labels</a>
    <a class="dropdown-item" href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>IPUMS API</h6>
    <a class="dropdown-item" href="../articles/ipums-api.html">Introduction to the API</a>
    <a class="dropdown-item" href="../articles/ipums-api-micro.html">Microdata API requests</a>
    <a class="dropdown-item" href="../articles/ipums-api-nhgis.html">NHGIS API requests</a>
    <div class="dropdown-divider"></div>
    <a class="external-link dropdown-item" href="https://ipums.org/exercises.shtml">Project-specific exercises</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ipums/ipumsr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://forum.ipums.org">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.ipums.org/">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>NHGIS API Requests</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/vignettes/ipums-api-nhgis.Rmd" class="external-link"><code>vignettes/ipums-api-nhgis.Rmd</code></a></small>
      <div class="d-none name"><code>ipums-api-nhgis.Rmd</code></div>
    </div>

    
    
<p>This vignette details the options available for requesting IPUMS
NHGIS data and metadata via the IPUMS API.</p>
<p>If you haven’t yet learned the basics of the IPUMS API workflow, you
may want to start with the <a href="ipums-api.html">IPUMS API
introduction</a>. The code below assumes you have registered and set up
your API key as described there.</p>
<p>In addition to NHGIS, the IPUMS API also supports several microdata
projects. For details about obtaining IPUMS microdata using ipumsr, see
the <a href="ipums-api-micro.html">microdata-specific vignette</a>.</p>
<p>Before getting started, we’ll load ipumsr and some helpful packages
for this demo:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tech.popdata.org/ipumsr/" class="external-link">ipumsr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="basic-ipums-nhgis-concepts">Basic IPUMS NHGIS concepts<a class="anchor" aria-label="anchor" href="#basic-ipums-nhgis-concepts"></a>
</h2>
<p>IPUMS NHGIS supports 3 main types of data products: datasets, time
series tables, and shapefiles.</p>
<ul>
<li><p>A <em>dataset</em> contains a collection of <em>data tables</em>
that each correspond to a particular tabulated summary statistic. A
dataset is distinguished by the years, geographic levels, and topics
that it covers. For instance, 2021 1-year data from the American
Community Survey (ACS) is encapsulated in a single dataset. In other
cases, a single census product will be split into multiple
datasets.</p></li>
<li><p>A <em>time series table</em> is a longitudinal data source that
links comparable statistics from multiple U.S. censuses in a single
bundle. A table is comprised of one or more related time series, each of
which describes a single summary statistic measured at multiple times
for a given geographic level.</p></li>
<li><p>A <em>shapefile</em> (or <em>GIS file</em>) contains geographic
data for a given geographic level and year. Typically, these files are
composed of polygon geometries containing the boundaries of census
reporting areas.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="ipums-nhgis-metadata">IPUMS NHGIS metadata<a class="anchor" aria-label="anchor" href="#ipums-nhgis-metadata"></a>
</h2>
<p>Of course, to make a request for any of these data sources, we have
to know the codes that the API uses to refer to them. Fortunately, we
can browse the metadata for all available IPUMS NHGIS data sources with
<code><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis()</a></code>.</p>
<p>Users can view summary metadata for all available data sources of a
given data type, or detailed metadata for a specific data source by
name.</p>
<div class="section level3">
<h3 id="summary-metadata">Summary metadata<a class="anchor" aria-label="anchor" href="#summary-metadata"></a>
</h3>
<p>To see a summary of all available sources for a given data product
type, use the <code>type</code> argument. This returns a data frame
containing the available datasets, data tables, time series tables, or
shapefiles.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"datasets"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   name      group       description                              sequence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1790_cPop 1790 Census Population Data [US, States &amp; Counties]       101</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1800_cPop 1800 Census Population Data [US, States &amp; Counties]       201</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1810_cPop 1810 Census Population Data [US, States &amp; Counties]       301</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1820_cPop 1820 Census Population Data [US, States &amp; Counties]       401</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1830_cPop 1830 Census Population Data [US, States &amp; Counties]       501</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1840_cAg  1840 Census Agriculture Data [US, States &amp; Counties]      601</span></span></code></pre></div>
<p>We can use basic functions from <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a> to filter the metadata to
those records of interest. For instance, if we wanted to find all the
data sources related to agriculture from the 1900 Census, we could
filter on <code>group</code> and <code>description</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">group</span> <span class="op">==</span> <span class="st">"1900 Census"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Agriculture"</span>, <span class="va">description</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   name       group       description                                    sequence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1900_cAg   1900 Census Agriculture Data [US, States &amp; Counties]           <span style="text-decoration: underline;">1</span>401</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1900_cPHAM 1900 Census Population, Housing, Agriculture &amp; Manufactur…     <span style="text-decoration: underline;">1</span>403</span></span></code></pre></div>
<p>The values listed in the <code>name</code> column correspond to the
code that you would use to request that dataset when creating an extract
definition to be submitted to the IPUMS API.</p>
<p>Similarly, for time series tables:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis</a></span><span class="op">(</span><span class="st">"time_series_tables"</span><span class="op">)</span></span></code></pre></div>
<p>While some of the metadata fields are consistent across different
data types, some, like <code>geographic_integration</code>, are specific
to time series tables:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tst</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   name  description         geographic_integration sequence time_series years   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A00   Total Population    Nominal                    100. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AV0   Total Population    Nominal                    100. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> B78   Total Population    Nominal                    100. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> CL8   Total Population    Standardized to 2010       100. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> A57   Persons by Urban/R… Nominal                    101. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> A59   Persons by Urban/R… Nominal                    101. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: geog_levels &lt;list&gt;</span></span></span></code></pre></div>
<p>Note that for time series tables, some metadata fields are stored in
list columns, where each entry is itself a data frame:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tst</span><span class="op">$</span><span class="va">years</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 3</span></span></span>
<span><span class="co">#&gt;    name  description sequence</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1790  1790               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1800  1800               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1810  1810               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1820  1820               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1830  1830               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1840  1840               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1850  1850               7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1860  1860               8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1870  1870              12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1880  1880              22</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more rows</span></span></span>
<span></span>
<span><span class="va">tst</span><span class="op">$</span><span class="va">geog_levels</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   name   description   sequence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> state  State                4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> county State--County       25</span></span></code></pre></div>
<p>To filter on these columns, we can use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl()</a></code> from <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a>. For instance, to find all
time series tables that include data from a particular year:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Iterate over each `years` entry, identifying whether that entry</span></span>
<span><span class="co"># contains "1840" in its `name` column.</span></span>
<span><span class="va">tst</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">years</span>, <span class="op">~</span> <span class="st">"1840"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   name  description        geographic_integration sequence time_series years   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A00   Total Population   Nominal                    100. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> A08   Persons by Sex [2] Nominal                    102. <span style="color: #949494;">&lt;tibble&gt;</span>    <span style="color: #949494;">&lt;tibble&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: geog_levels &lt;list&gt;</span></span></span></code></pre></div>
<p>For more details on working with nested data frames, see the
documentation for <a href="https://dplyr.tidyverse.org/" class="external-link">dplyr</a> and
<a href="https://purrr.tidyverse.org/" class="external-link">purrr</a>.</p>
</div>
<div class="section level3">
<h3 id="detailed-metadata">Detailed metadata<a class="anchor" aria-label="anchor" href="#detailed-metadata"></a>
</h3>
<p>Once we have identified a data source of interest, we can find out
more about its detailed options by providing its name to the
corresponding argument of <code><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cAg_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"1900_cAg"</span><span class="op">)</span></span></code></pre></div>
<p>This provides a comprehensive list of the possible specifications for
the input data source. For instance, for the 1900_cAg dataset, we have
66 tables to choose from, and 3 possible geographic levels:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cAg_meta</span><span class="op">$</span><span class="va">data_tables</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 66 × 4</span></span></span>
<span><span class="co">#&gt;    name  nhgis_code description                           sequence</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> NT1   AWS        Total Population                             1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> NT2   AW3        Number of Farms                              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> NT3   AXE        Average Farm Size                            3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> NT4   AXP        Farm Acreage                                 4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> NT5   AXZ        Farm Management                              5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> NT6   AYA        Race of Farmer                               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> NT7   AYJ        Race of Farmer by Detailed Management        7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> NT8   AYK        Number of Farms                              8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> NT9   AYL        Farms with Buildings                         9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> NT10  AWT        Acres of Farmland                           10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 56 more rows</span></span></span>
<span></span>
<span><span class="va">cAg_meta</span><span class="op">$</span><span class="va">geog_levels</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;   name   description   has_geog_extent_selection sequence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> nation Nation        FALSE                            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> state  State         FALSE                            4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> county State--County FALSE                           25</span></span></code></pre></div>
<p>You can also get detailed metadata for an individual data table.
Since data tables belong to specific datasets, both need to be specified
to identify a data table:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"1900_cAg"</span>, data_table <span class="op">=</span> <span class="st">"NT2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "NT2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "Number of Farms"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $universe</span></span>
<span><span class="co">#&gt; [1] "Farms"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nhgis_code</span></span>
<span><span class="co">#&gt; [1] "AW3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sequence</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dataset_name</span></span>
<span><span class="co">#&gt; [1] "1900_cAg"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $variables</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   description nhgis_code</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Total       AW3001</span></span></code></pre></div>
<p>Note that the <code>name</code> element is the one that contains the
codes used for interacting with the IPUMS API. The
<code>nhgis_code</code> element refers to the prefix attached to
individual variables in the output data, and the API will throw an error
if you use it in an extract definition. For more details on interpreting
each of the provided metadata elements, see the documentation for
<code><a href="../reference/get_metadata_nhgis.html">get_metadata_nhgis()</a></code>.</p>
<p>Now that we have identified some of our options, we can go ahead and
define an extract request to submit to the IPUMS API.</p>
</div>
</div>
<div class="section level2">
<h2 id="defining-an-ipums-nhgis-extract-request">Defining an IPUMS NHGIS extract request<a class="anchor" aria-label="anchor" href="#defining-an-ipums-nhgis-extract-request"></a>
</h2>
<p>To create an extract definition containing the specifications for a
specific set of IPUMS NHGIS data, use
<code><a href="../reference/define_extract_nhgis.html">define_extract_nhgis()</a></code>.</p>
<p>When you define an extract request, you can specify the data to be
included in the extract and indicate the desired format and layout.</p>
<div class="section level3">
<h3 id="basic-extract-definitions">Basic extract definitions<a class="anchor" aria-label="anchor" href="#basic-extract-definitions"></a>
</h3>
<p>Let’s say we’re interested in getting state-level data on the number
of farms and their average size from the 1900_cAg dataset that we
identified above. As we can see in the metadata, these data are
contained in tables NT2 and NT3:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cAg_meta</span><span class="op">$</span><span class="va">data_tables</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 66 × 4</span></span></span>
<span><span class="co">#&gt;    name  nhgis_code description                           sequence</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> NT1   AWS        Total Population                             1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> NT2   AW3        Number of Farms                              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> NT3   AXE        Average Farm Size                            3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> NT4   AXP        Farm Acreage                                 4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> NT5   AXZ        Farm Management                              5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> NT6   AYA        Race of Farmer                               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> NT7   AYJ        Race of Farmer by Detailed Management        7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> NT8   AYK        Number of Farms                              8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> NT9   AYL        Farms with Buildings                         9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> NT10  AWT        Acres of Farmland                           10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 56 more rows</span></span></span></code></pre></div>
<p>To request these data, we need to make an explicit <em>dataset
specification</em>. All datasets must be associated with a selection of
data tables and geographic levels. We can use the <code><a href="../reference/ds_spec.html">ds_spec()</a></code>
helper function to specify our selections for these parameters.
<code><a href="../reference/ds_spec.html">ds_spec()</a></code> bundles all the selections for a given dataset
together into a single object (in this case, a <code>ds_spec</code>
object):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds_spec.html">ds_spec</a></span><span class="op">(</span></span>
<span>  <span class="st">"1900_cAg"</span>, </span>
<span>  data_tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NT1"</span>, <span class="st">"NT2"</span><span class="op">)</span>, </span>
<span>  geog_levels <span class="op">=</span> <span class="st">"state"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ name       : chr "1900_cAg"</span></span>
<span><span class="co">#&gt;  $ data_tables: chr [1:2] "NT1" "NT2"</span></span>
<span><span class="co">#&gt;  $ geog_levels: chr "state"</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "ds_spec" "ipums_spec" "list"</span></span></code></pre></div>
<p>This dataset specification can then be provided to the extract
definition:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhgis_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Example farm data in 1900"</span>,</span>
<span>  datasets <span class="op">=</span> <span class="va">dataset</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nhgis_ext</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span></span>
<span><span class="co">#&gt; Description: Example farm data in 1900</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>1900_cAg</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>NT1, NT2</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span></span></code></pre></div>
<p>(Dataset specifications can also include selections for
<code>years</code> and <code>breakdown_values</code>, but these are not
available for all datasets.)</p>
<p>Similarly, to make a request for time series tables, use the
<code><a href="../reference/ds_spec.html">tst_spec()</a></code> helper. This makes a <code>tst_spec</code>
object containing a time series table specification.</p>
<p>Time series tables do not contain individual data tables, but do
require a geographic level selection, and allow an optional selection of
years:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Example time series table request"</span>,</span>
<span>  time_series_tables <span class="op">=</span> <span class="fu"><a href="../reference/ds_spec.html">tst_spec</a></span><span class="op">(</span></span>
<span>    <span class="st">"CW3"</span>, </span>
<span>    geog_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county"</span>, <span class="st">"tract"</span><span class="op">)</span>,</span>
<span>    years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1990"</span>, <span class="st">"2000"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span></span>
<span><span class="co">#&gt; Description: Example time series table request</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>CW3</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, tract</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Years: </span>1990, 2000</span></span></code></pre></div>
<p>An attempt to define an extract that does not have all the required
specifications for a given dataset or time series table will throw an
error:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Invalid extract"</span>,</span>
<span>  datasets <span class="op">=</span> <span class="fu"><a href="../reference/ds_spec.html">ds_spec</a></span><span class="op">(</span><span class="st">"1900_STF1"</span>, data_tables <span class="op">=</span> <span class="st">"NP1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `validate_ipums_extract()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid `ds_spec` specification:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> `geog_levels` must not contain missing values.</span></span></code></pre></div>
<p>Note that it is still possible to make invalid extract requests (for
instance, by requesting a dataset or table that doesn’t exist). This
kind of issue will be caught upon submission to the API, not upon the
creation of the extract definition.</p>
<p>Shapefiles don’t have any additional specification options, and
therefore can be requested simply by providing their names:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Example shapefiles request"</span>,</span>
<span>  shapefiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us_county_2021_tl2021"</span>, <span class="st">"us_county_2020_tl2020"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span></span>
<span><span class="co">#&gt; Description: Example shapefiles request</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Shapefiles: </span>us_county_2021_tl2021, us_county_2020_tl2020</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="more-complicated-extract-definitions">More complicated extract definitions<a class="anchor" aria-label="anchor" href="#more-complicated-extract-definitions"></a>
</h3>
<p>It’s possible to request data for multiple datasets (or time series
tables) in a single extract definition. To do so, pass a
<code>list</code> of <code>ds_spec</code> or <code>tst_spec</code>
objects in <code><a href="../reference/define_extract_nhgis.html">define_extract_nhgis()</a></code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Slightly more complicated extract request"</span>,</span>
<span>  datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/ds_spec.html">ds_spec</a></span><span class="op">(</span><span class="st">"2018_ACS1"</span>, <span class="st">"B01001"</span>, <span class="st">"state"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/ds_spec.html">ds_spec</a></span><span class="op">(</span><span class="st">"2019_ACS1"</span>, <span class="st">"B01001"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  shapefiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us_state_2018_tl2018"</span>, <span class="st">"us_state_2019_tl2019"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span></span>
<span><span class="co">#&gt; Description: Slightly more complicated extract request</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2018_ACS1</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2019_ACS1</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Shapefiles: </span>us_state_2018_tl2018, us_state_2019_tl2019</span></span></code></pre></div>
<p>For extracts with multiple datasets or time series tables, it may be
easier to generate the specifications independently before creating your
extract request object. You can quickly create multiple
<code>ds_spec</code> objects by iterating across the specifications you
want to include. Here, we use purrr to do so, but you could also use a
<code>for</code> loop:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019_ACS1"</span>, <span class="st">"2018_ACS1"</span><span class="op">)</span></span>
<span><span class="va">tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B01001"</span>, <span class="st">"B01002"</span><span class="op">)</span></span>
<span><span class="va">geogs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county"</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For each dataset to include, create a specification with the</span></span>
<span><span class="co"># data tabels and geog levels indicated above</span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="va">ds_names</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="../reference/ds_spec.html">ds_spec</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">.x</span>, </span>
<span>    data_tables <span class="op">=</span> <span class="va">tables</span>, </span>
<span>    geog_levels <span class="op">=</span> <span class="va">geogs</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nhgis_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Slightly more complicated extract request"</span>,</span>
<span>  datasets <span class="op">=</span> <span class="va">datasets</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nhgis_ext</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span></span>
<span><span class="co">#&gt; Description: Slightly more complicated extract request</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2019_ACS1</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001, B01002</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, state</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2018_ACS1</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001, B01002</span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, state</span></span></code></pre></div>
<p>This workflow also makes it easy to quickly update the specifications
in the future. For instance, to add the 2017 ACS 1-year data to the
extract definition above, you’d only need to add
<code>"2017_ACS1"</code> to the <code>ds_names</code> variable. The
iteration would automatically add the selected tables and geog levels
for the new dataset. (This workflow works particularly well for ACS
datasets, which often have the same data table names across
datasets.)</p>
</div>
<div class="section level3">
<h3 id="data-layout-and-file-format">Data layout and file format<a class="anchor" aria-label="anchor" href="#data-layout-and-file-format"></a>
</h3>
<p>IPUMS NHGIS extract definitions also support additional options to
modify the layout and format of the extract’s resulting data files.</p>
<p>For extracts that contain time series tables, the
<code>tst_layout</code> argument indicates how the longitudinal data
should be organized.</p>
<p>For extracts that contain datasets with multiple breakdowns or data
types, use the <code>breakdown_and_data_type_layout</code> argument to
specify a layout . This is most common for data sources that contain
both estimates and margins of error, like the ACS.</p>
<p>File formats can be specified with the <code>data_format</code>
argument. IPUMS NHGIS currently distributes files in csv and fixed-width
format.</p>
<p>See the documentation for <code><a href="../reference/define_extract_nhgis.html">define_extract_nhgis()</a></code> for
more details on these options.</p>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>Once you have defined an extract request, you can submit the extract
for processing:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhgis_ext_submitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">nhgis_ext</span><span class="op">)</span></span></code></pre></div>
<p>The workflow for submitting and monitoring an extract request and
downloading its files when complete is described in the <a href="ipums-api.html">IPUMS API introduction</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
