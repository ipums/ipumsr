<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the IPUMS API for R Users • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Introduction to the IPUMS API for R Users">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">IPUMS Data</li>
    <li>
      <a href="../articles/ipums-read.html">Read IPUMS data</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">IPUMS API</li>
    <li>
      <a href="../articles/ipums-api.html">Introduction to the API</a>
    </li>
    <li>
      <a href="../articles/ipums-api-micro.html">Microdata API requests</a>
    </li>
    <li>
      <a href="../articles/ipums-api-nhgis.html">NHGIS API requests</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="https://ipums.org/exercises.shtml" class="external-link">Project-specific exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipums/ipumsr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/" class="external-link">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the IPUMS API for R Users</h1>
                        <h4 data-toc-skip class="author">Institute for
Social Research and Data Innovation</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/vignettes/ipums-api.Rmd" class="external-link"><code>vignettes/ipums-api.Rmd</code></a></small>
      <div class="hidden name"><code>ipums-api.Rmd</code></div>

    </div>

    
    
<p>The IPUMS API provides two asset types, both of which are supported
by ipumsr:</p>
<ul>
<li><p><strong>IPUMS extract</strong> endpoints can be used to submit
extract requests for processing and download completed extract
files.</p></li>
<li><p><strong>IPUMS metadata</strong> endpoints can be used to discover
and explore available IPUMS data as well as retrieve codes, names, and
other extract parameters necessary to form extract requests.</p></li>
</ul>
<p>Use of the IPUMS API enables the adoption of a programmatic workflow
that can help users to:</p>
<ul>
<li>Precisely recreate the specifications of previous extract requests,
making analysis scripts reproducible and self-contained</li>
<li>Save extract request definitions that can be shared with others
without violating IPUMS conditions</li>
<li>Integrate the extract download process with functions to load data
into R</li>
<li>Quickly identify and explore available IPUMS data sources</li>
</ul>
<p>The basic workflow for interacting with the IPUMS API is as
follows:</p>
<ol style="list-style-type: decimal">
<li>
<a href="#define">Define</a> the parameters of an extract
request</li>
<li>
<a href="#submit">Submit</a> the extract request to the IPUMS
API</li>
<li>
<a href="#wait">Wait</a> for an extract to complete</li>
<li>
<a href="#download">Download</a> a completed extract</li>
</ol>
<p>Before getting started, we’ll load the necessary packages for the
examples in this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tech.popdata.org/ipumsr/" class="external-link">ipumsr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="api-availability">API Availability<a class="anchor" aria-label="anchor" href="#api-availability"></a>
</h2>
<p>IPUMS <strong>extract</strong> support is currently available via API
for the following collections:</p>
<ul>
<li>IPUMS USA</li>
<li>IPUMS CPS</li>
<li>IPUMS International</li>
<li>IPUMS NHGIS</li>
</ul>
<p>Note that this support only includes data available via a
collection’s extract engine. Many collections provide additional data
via direct download, but these products are not supported by the IPUMS
API.</p>
<p>IPUMS <strong>metadata</strong> support is currently available via
API for the following collections:</p>
<ul>
<li>IPUMS NHGIS</li>
</ul>
<p>API support will continue to be added for more collections in the
future. You can check general API availability for all IPUMS collections
with <code><a href="../reference/ipums_data_collections.html">ipums_data_collections()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_data_collections.html">ipums_data_collections</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 4</span></span></span>
<span><span class="co">#&gt;    collection_name     collection_type code_for_api api_support</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> IPUMS USA           microdata       usa          TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> IPUMS CPS           microdata       cps          TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> IPUMS International microdata       ipumsi       TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> IPUMS NHGIS         aggregate data  nhgis        TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> IPUMS IHGIS         aggregate data  ihgis        FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> IPUMS AHTUS         microdata       ahtus        FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> IPUMS MTUS          microdata       mtus         FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> IPUMS ATUS          microdata       atus         FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> IPUMS DHS           microdata       dhs          FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> IPUMS Higher Ed     microdata       highered     FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> IPUMS MEPS          microdata       meps         FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> IPUMS NHIS          microdata       nhis         FALSE      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> IPUMS PMA           microdata       pma          FALSE</span></span></code></pre></div>
<div class="section level3">
<h3 id="note-new-features-currently-in-development">Note: New features currently in development<a class="anchor" aria-label="anchor" href="#note-new-features-currently-in-development"></a>
</h3>
<p>The tools in ipumsr may not necessarily support all the functionality
currently supported by the IPUMS API. See the <a href="https://developer.ipums.org/docs/apiprogram/" class="external-link">API
documentation</a> for more information about its latest features.
Furthermore, the API tools in ipumsr are in active development, and some
functionality may not yet be stable.</p>
</div>
</div>
<div class="section level2">
<h2 id="set-key">Set up your API key<a class="anchor" aria-label="anchor" href="#set-key"></a>
</h2>
<p>To interact with the IPUMS API, you’ll need to register for access
with the IPUMS project you’ll be using. If you have not yet registered,
you can find links to register for each of the API-supported IPUMS
collections below:</p>
<ul>
<li><a href="https://uma.pop.umn.edu/usa/user/new?return_url=https%3A%2F%2Fusa.ipums.org%2Fusa-action%2Fmenu" class="external-link">IPUMS
USA</a></li>
<li><a href="https://uma.pop.umn.edu/cps/user/new?return_url=https%3A%2F%2Fcps.ipums.org%2Fcps-action%2Fmenu" class="external-link">IPUMS
CPS</a></li>
<li><a href="https://uma.pop.umn.edu/ipumsi/user/new?return_url=https%3A%2F%2Fipumsi.ipums.org%2Fipumsi-action%2Fmenu" class="external-link">IPUMS
International</a></li>
<li><a href="https://uma.pop.umn.edu/nhgis/user/new?return_url=https%3A%2F%2Fnhgis.ipums.org%2Fnhgis-action%2Fmenu" class="external-link">IPUMS
NHGIS</a></li>
</ul>
<p>Once you’re registered, you’ll be able to <a href="https://account.ipums.org/api_keys" class="external-link">create an API key</a>.</p>
<p>By default, ipumsr API functions assume that your key is stored in
the <code>IPUMS_API_KEY</code> environment variable. You can also
provide your key directly to these functions, but storing it in an
environment variable saves you some typing and helps prevent you from
inadvertently sharing your key with others (for instance, on
GitHub).</p>
<p>You can save your API key to the <code>IPUMS_API_KEY</code>
environment variable with <code><a href="../reference/set_ipums_api_key.html">set_ipums_api_key()</a></code>. To save your
key for use in future sessions, set <code>save = TRUE</code>. This will
add your API key to your <code>.Renviron</code> file in your user home
directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save key in .Renviron for use across sessions</span></span>
<span><span class="fu"><a href="../reference/set_ipums_api_key.html">set_ipums_api_key</a></span><span class="op">(</span><span class="st">"paste-your-key-here"</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The rest of this vignette assumes you have obtained an API key and
stored it in the <code>IPUMS_API_KEY</code> environment variable.</p>
</div>
<div class="section level2">
<h2 id="define">Define an extract request<a class="anchor" aria-label="anchor" href="#define"></a>
</h2>
<p>Each IPUMS collection has its own extract definition function that is
used to specify the parameters of a new extract request from scratch.
These functions take the form <code>define_extract_*()</code>:</p>
<ul>
<li><code><a href="../reference/define_extract-micro.html">define_extract_usa()</a></code></li>
<li><code><a href="../reference/define_extract-micro.html">define_extract_cps()</a></code></li>
<li><code><a href="../reference/define_extract-micro.html">define_extract_ipumsi()</a></code></li>
<li><code><a href="../reference/define_extract_nhgis.html">define_extract_nhgis()</a></code></li>
</ul>
<p>When you define an extract request, you can specify the data to be
included in the extract and indicate the desired format and layout.</p>
<p>For instance, the following defines a simple IPUMS USA extract
request for the <code>AGE</code>, <code>SEX</code>, <code>RACE</code>,
<code>STATEFIP</code>, and <code>MARST</code> variables from the 2018
and 2019 American Community Survey (ACS):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract-micro.html">define_extract_usa</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"USA extract for API vignette"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>, <span class="st">"us2019a"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"RACE"</span>, <span class="st">"STATEFIP"</span>, <span class="st">"MARST"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">usa_ext_def</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS USA extract </span></span>
<span><span class="co">#&gt; Description: USA extract for API vignette</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) us2018a, us2019a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(5 total) AGE, SEX, RACE, STATEFIP, MARST</span></span></code></pre></div>
<p>The exact extract definition options vary across collections, but all
collections can be used with the same general workflow. For more details
on the available extract definition options, see the associated <a href="ipums-api-micro.html">microdata</a> and <a href="ipums-api-nhgis.html">NHGIS</a> vignettes.</p>
<p>For the purposes of demonstrating the overall workflow, we will
continue to work with the sample IPUMS USA extract definition created
above.</p>
<div class="section level3">
<h3 id="extract-request-objects">Extract request objects<a class="anchor" aria-label="anchor" href="#extract-request-objects"></a>
</h3>
<p><code>define_extract_*()</code> functions always produce an
<code>ipums_extract</code> object, which can be handled by other API
functions (see <code><a href="../reference/ipums_extract-class.html">?ipums_extract</a></code>). Furthermore, these objects
will have a subclass for the particular collection with which they are
associated.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">usa_ext_def</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "usa_extract"   "micro_extract" "ipums_extract" "list"</span></span></code></pre></div>
<p>Many of the specifications for a given extract request object can be
accessed by indexing the object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usa_ext_def</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "us2018a" "us2019a"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usa_ext_def</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AGE"      "SEX"      "RACE"     "STATEFIP" "MARST"</span></span>
<span></span>
<span><span class="va">usa_ext_def</span><span class="op">$</span><span class="va">data_format</span></span>
<span><span class="co">#&gt; [1] "fixed_width"</span></span></code></pre></div>
<p><code>ipums_extract</code> objects also contain information about the
extract request’s processing status and its assigned extract number,
which serves as an identifier for the extract request. Since this
extract request is still unsubmitted, it has no request number:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_def</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">#&gt; [1] "unsubmitted"</span></span>
<span></span>
<span><span class="va">usa_ext_def</span><span class="op">$</span><span class="va">number</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>To obtain the data requested in the extract definition, we must first
submit it to the IPUMS API for processing.</p>
</div>
</div>
<div class="section level2">
<h2 id="submit">Submit an extract request<a class="anchor" aria-label="anchor" href="#submit"></a>
</h2>
<p>To submit an extract definition, use
<code><a href="../reference/submit_extract.html">submit_extract()</a></code>.</p>
<p>If no errors are detected in the extract definition, a submitted
extract request will be returned with its assigned number and status.
Storing the returned object can be useful for checking the extract
request’s status later.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_submitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">usa_ext_def</span><span class="op">)</span></span>
<span><span class="co">#&gt; Successfully submitted IPUMS USA extract number 348</span></span></code></pre></div>
<p>The extract number will be stored in the returned object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_submitted</span><span class="op">$</span><span class="va">number</span></span>
<span><span class="co">#&gt; [1] 348</span></span>
<span></span>
<span><span class="va">usa_ext_submitted</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">#&gt; [1] "queued"</span></span></code></pre></div>
<p>Note that some fields of a submitted extract may be automatically
updated by the API upon submission. For instance, for microdata
extracts, additional preselected variables may be added to the extract
even if they weren’t specified explicitly in the extract definition.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usa_ext_submitted</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "YEAR"     "SAMPLE"   "SERIAL"   "CBSERIAL" "HHWT"     "CLUSTER" </span></span>
<span><span class="co">#&gt;  [7] "STATEFIP" "STRATA"   "GQ"       "PERNUM"   "PERWT"    "SEX"     </span></span>
<span><span class="co">#&gt; [13] "AGE"      "MARST"    "RACE"</span></span></code></pre></div>
<p>If you forget to store the updated extract object returned by
<code><a href="../reference/submit_extract.html">submit_extract()</a></code>, you can use the
<code><a href="../reference/get_extract_info.html">get_last_extract_info()</a></code> helper to request the information
for your most recent extract request for a given collection:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_submitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_last_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usa_ext_submitted</span><span class="op">$</span><span class="va">number</span></span>
<span><span class="co">#&gt; [1] 348</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wait">Wait for an extract request to complete<a class="anchor" aria-label="anchor" href="#wait"></a>
</h2>
<p>It may take some time for the IPUMS servers to process your extract
request. You can ensure that an extract has finished processing before
you attempt to download its files by using
<code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code>. This polls the API regularly until
processing has completed (by default, each interval increases by 10
seconds). It then returns an <code>ipums_extract</code> object
containing the completed extract definition.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="va">usa_ext_submitted</span><span class="op">)</span></span>
<span><span class="co">#&gt; Checking extract status...</span></span>
<span><span class="co">#&gt; Waiting 10 seconds...</span></span>
<span><span class="co">#&gt; Checking extract status...</span></span>
<span><span class="co">#&gt; IPUMS USA extract 348 is ready to download.</span></span>
<span></span>
<span><span class="va">usa_ext_complete</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">#&gt; [1] "completed"</span></span>
<span></span>
<span><span class="co"># `download_links` should be populated if the extract is ready for download</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usa_ext_complete</span><span class="op">$</span><span class="va">download_links</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "r_command_file"     "basic_codebook"     "data"              </span></span>
<span><span class="co">#&gt; [4] "stata_command_file" "sas_command_file"   "spss_command_file" </span></span>
<span><span class="co">#&gt; [7] "ddi_codebook"</span></span></code></pre></div>
<p>Note that <code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code> will tie up your R session
until your extract is ready to download. While this is fine in a
strictly programmatic workflow, it may be frustrating when working
interactively, especially for large extracts or when the IPUMS servers
are busy.</p>
<p>In these cases, you can manually check whether an extract is ready
for download with <code><a href="../reference/wait_for_extract.html">is_extract_ready()</a></code>. As long as this
returns <code>TRUE</code>, you should be able to download your extract’s
files.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wait_for_extract.html">is_extract_ready</a></span><span class="op">(</span><span class="va">usa_ext_submitted</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>For a more detailed status check, provide the extract’s collection
and number to <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code>. This returns an
<code>ipums_extract</code> object reflecting the requested extract
definition with the most current status. The <code>status</code> of a
submitted extract will be one of <code>"queued"</code>,
<code>"started"</code>, <code>"produced"</code>,
<code>"canceled"</code>, <code>"failed"</code>, or
<code>"completed"</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_submitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="va">usa_ext_submitted</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usa_ext_submitted</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">#&gt; [1] "completed"</span></span></code></pre></div>
<p>Note that extracts are removed from the IPUMS servers after a set
period of time (72 hours for microdata collections, 2 weeks for IPUMS
NHGIS). Therefore, an extract that has a <code>"completed"</code> status
may still be unavailable for download.</p>
<p><code><a href="../reference/wait_for_extract.html">is_extract_ready()</a></code> will alert you if the extract has
expired and needs to be resubmitted. Simply use
<code><a href="../reference/submit_extract.html">submit_extract()</a></code> to resubmit an extract request. Note that
this will produce a <em>new</em> extract (with a new extract number),
even if the extract definition is identical.</p>
</div>
<div class="section level2">
<h2 id="download">Download an extract<a class="anchor" aria-label="anchor" href="#download"></a>
</h2>
<p>Once your extract has finished processing, use
<code><a href="../reference/download_extract.html">download_extract()</a></code> to download the extract’s data files to
your local machine. This will return the path to the downloaded file(s)
required to load the data into R.</p>
<p>For microdata collections, this will be the path to the DDI codebook
(.xml) file, which can be used to read the associated data (contained in
a .dat.gz file).</p>
<p>For NHGIS, this will be a path to the .zip archive containing the
requested data files and/or shapefiles.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By default, downloads to your current working directory</span></span>
<span><span class="va">filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="va">usa_ext_submitted</span><span class="op">)</span></span></code></pre></div>
<p>The files produced by <code><a href="../reference/download_extract.html">download_extract()</a></code> can be passed
directly into the reader functions provided by ipumsr. For instance, for
microdata projects:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span><span class="op">(</span><span class="va">filepath</span><span class="op">)</span></span>
<span><span class="va">micro_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span><span class="op">)</span></span></code></pre></div>
<p>If instead you’re working with an NHGIS extract, use
<code><a href="../reference/read_nhgis.html">read_nhgis()</a></code> or <code><a href="../reference/read_ipums_sf.html">read_ipums_sf()</a></code>.</p>
<p>See the <a href="ipums-read.html">associated vignette</a> for more
information about loading IPUMS data into R.</p>
</div>
<div class="section level2">
<h2 id="recent">Get info on past extracts<a class="anchor" aria-label="anchor" href="#recent"></a>
</h2>
<p>To retrieve the definition corresponding to a particular extract,
provide its collection and number to <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code>.
These can be provided either as a single string of the form
<code>"collection:number"</code> or as a length-2 vector:
<code>c(collection, number)</code>. Several other API functions support
this syntax as well.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:47"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternatively:</span></span>
<span><span class="va">usa_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"usa"</span>, <span class="fl">47</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usa_ext</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 47</span></span>
<span><span class="co">#&gt; Description: Test extract</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(1 total) us2017b</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(8 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, GQ, PERNUM, PERWT</span></span></code></pre></div>
<p>If you know you made a specific extract definition in the past, but
you can’t remember the exact number, you can use
<code><a href="../reference/get_extract_history.html">get_extract_history()</a></code> to peruse your recent extract
requests for a particular collection.</p>
<p>By default, this returns your 10 most recent extract requests as a
list of <code>ipums_extract</code> objects. You can adjust how many
requests to retrieve with the <code>how_many</code> argument:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_extracts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_history.html">get_extract_history</a></span><span class="op">(</span><span class="st">"usa"</span>, how_many <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usa_extracts</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 348</span></span>
<span><span class="co">#&gt; Description: USA extract for API vignette</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) us2018a, us2019a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(15 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, CLUSTER,...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 347</span></span>
<span><span class="co">#&gt; Description: Data from long ago</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(1 total) us1880a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(12 total) YEAR, SAMPLE, SERIAL, HHWT, CLUSTER, STRATA, G...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 346</span></span>
<span><span class="co">#&gt; Description: Data from 2017 PRCS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(1 total) us2017b</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(9 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, GQ, PERNU...</span></span></code></pre></div>
<p>Because this is a list of <code>ipums_extract</code> objects, you can
operate on them with the API functions that have been introduced
already.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wait_for_extract.html">is_extract_ready</a></span><span class="op">(</span><span class="va">usa_extracts</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>You can also iterate through your extract history to find extracts
with particular characteristics. For instance, we can use
<code><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">purrr::keep()</a></code> to find all extracts that contain a certain
variable or are ready for download:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">usa_extracts</span>, <span class="op">~</span> <span class="st">"MARST"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 348</span></span>
<span><span class="co">#&gt; Description: USA extract for API vignette</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) us2018a, us2019a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(15 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, CLUSTER,...</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">usa_extracts</span>, <span class="va">is_extract_ready</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 348</span></span>
<span><span class="co">#&gt; Description: USA extract for API vignette</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(2 total) us2018a, us2019a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(15 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, CLUSTER,...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 347</span></span>
<span><span class="co">#&gt; Description: Data from long ago</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(1 total) us1880a</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(12 total) YEAR, SAMPLE, SERIAL, HHWT, CLUSTER, STRATA, G...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; Submitted IPUMS USA extract number 346</span></span>
<span><span class="co">#&gt; Description: Data from 2017 PRCS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Samples: </span>(1 total) us2017b</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Variables: </span>(9 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, GQ, PERNU...</span></span></code></pre></div>
<p>Or we can use the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> family to browse certain
values:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">usa_extracts</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">description</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "USA extract for API vignette" "Data from long ago"          </span></span>
<span><span class="co">#&gt; [3] "Data from 2017 PRCS"</span></span></code></pre></div>
<p>If you regularly use only a single IPUMS collection, you can save
yourself some typing by setting that collection as your default.
<code><a href="../reference/set_ipums_default_collection.html">set_ipums_default_collection()</a></code> will save a specified
collection to the value of the <code>IPUMS_DEFAULT_COLLECTION</code>
environment variable. If you have a default collection set, API
functions will use that collection in all requests, assuming no other
collection is specified.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_ipums_default_collection.html">set_ipums_default_collection</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span> <span class="co"># Set `save = TRUE` to store across sessions</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the default collection:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"IPUMS_DEFAULT_COLLECTION"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "usa"</span></span>
<span></span>
<span><span class="co"># Most recent USA extract:</span></span>
<span><span class="va">usa_last</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_last_extract_info</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Request info on extract request "usa:10"</span></span>
<span><span class="va">usa_ext_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can still request other collections as usual:</span></span>
<span><span class="va">cps_ext_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"cps:10"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="share">Share an extract definition<a class="anchor" aria-label="anchor" href="#share"></a>
</h2>
<p>One exciting feature enabled by the IPUMS API is the ability to share
a standardized extract definition with other IPUMS users so that they
can create an identical extract request themselves. The terms of use for
most IPUMS collections prohibit the redistribution of IPUMS data, but
don’t prohibit sharing data extract definitions.</p>
<p>ipumsr facilitates this type of sharing with
<code><a href="../reference/save_extract_as_json.html">save_extract_as_json()</a></code> and
<code><a href="../reference/save_extract_as_json.html">define_extract_from_json()</a></code>, which read and write
<code>ipums_extract</code> objects to and from a standardized
JSON-formatted file.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_ext_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:10"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/save_extract_as_json.html">save_extract_as_json</a></span><span class="op">(</span><span class="va">usa_ext_10</span>, file <span class="op">=</span> <span class="st">"usa_extract_10.json"</span><span class="op">)</span></span></code></pre></div>
<p>At this point, you can send <code>usa_extract_10.json</code> to
another user to allow them to create a duplicate
<code>ipums_extract</code> object, which they can load and submit to the
API themselves (as long as they have <a href="#set-key">API
access</a>).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clone_of_usa_ext_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/save_extract_as_json.html">define_extract_from_json</a></span><span class="op">(</span><span class="st">"usa_extract_10.json"</span><span class="op">)</span></span>
<span><span class="va">usa_ext_10_resubmitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">clone_of_usa_ext_10</span><span class="op">)</span></span></code></pre></div>
<p>Note that the code in the previous chunk assumes that the file is
saved in the current working directory. If it’s saved somewhere else,
replace <code>"usa_extract_10.json"</code> with the full path to the
file.</p>
</div>
<div class="section level2">
<h2 id="revise-a-previous-extract-request">Revise a previous extract request<a class="anchor" aria-label="anchor" href="#revise-a-previous-extract-request"></a>
</h2>
<p>Occasionally, you may want to modify an existing extract definition
(e.g. to update an analysis with new data). The easiest way to do so is
to add the new specifications to the <code>define_extract_*()</code>
code that produced the original extract definition. This is why we
highly recommend that you save this code somewhere where it can be
accessed and updated in the future.</p>
<p>However, there are cases where the original extract definition code
does not exist (e.g. if the extract was created using the online IPUMS
extract system). In this case, the best approach is to view the extract
definition with <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> and create a new extract
definition (using a <code>define_extract_*()</code> function) that
reproduces that definition along with the desired modifications. While
this may be a bit tedious for complex extract definitions, it is a
one-time investment that will make any future updates to the extract
definition much easier.</p>
<p>Previously, we encouraged users to use the helpers
<code><a href="../reference/add_to_extract.html">add_to_extract()</a></code> and <code><a href="../reference/remove_from_extract.html">remove_from_extract()</a></code>
when modifying extracts. We now encourage you to re-write extract
definitions because they improve reproducibility: extract definition
code will always be more clear and stable if it is written explicitly,
rather than based only on an old extract number. These two functions may
be retired in the future.</p>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>The core API functions in ipumsr are compatible with one another such
that they can be combined into a single pipeline that requests,
downloads, and reads your extract data into an R data frame:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usa_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract-micro.html">define_extract_usa</a></span><span class="op">(</span></span>
<span>  <span class="st">"USA extract for API vignette"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>, <span class="st">"us2019a"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"RACE"</span>, <span class="st">"STATEFIP"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Note that for NHGIS extracts that contain both data and shapefiles, a
single file will need to be selected before reading, as
<code><a href="../reference/download_extract.html">download_extract()</a></code> will return the path to each file. For
instance, for a hypothetical <code>nhgis_extract</code> that contains
both tabular and spatial data:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhgis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="va">nhgis_extract</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Select only the tabular data file to read</span></span>
<span>  <span class="fu"><a href="../reference/read_nhgis.html">read_nhgis</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Not only does this API workflow allow you to obtain IPUMS data
without ever leaving your R environment, but it also allows you to
retain a reproducible record of your process. This makes it much easier
to document your workflow, collaborate with other researchers, and
update your analysis in the future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> .</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
