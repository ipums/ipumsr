<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Read data from an IPUMS microdata extract by chunk — read_ipums_micro_chunked • ipumsr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Read data from an IPUMS microdata extract by chunk — read_ipums_micro_chunked"><meta name="description" content="Read a microdata dataset downloaded from the IPUMS extract system in chunks.
Use these functions to read a file that is too large to store in memory
at a single time. The file is processed in chunks of a given size, with a
provided callback function applied to each chunk.
Two files are required to load IPUMS microdata extracts:
A DDI codebook file
(.xml) used to parse the extract's data file
A data file (either .dat.gz or .csv.gz)


See Downloading IPUMS files below for more information about downloading
these files.
read_ipums_micro_chunked() and read_ipums_micro_list_chunked() differ
in their handling of extracts that contain multiple record types.
See Data structures below.
Note that Stata, SAS, and SPSS file formats are not supported by
ipumsr readers. Convert your extract to fixed-width or CSV format, or see
haven for help
loading these files."><meta property="og:description" content="Read a microdata dataset downloaded from the IPUMS extract system in chunks.
Use these functions to read a file that is too large to store in memory
at a single time. The file is processed in chunks of a given size, with a
provided callback function applied to each chunk.
Two files are required to load IPUMS microdata extracts:
A DDI codebook file
(.xml) used to parse the extract's data file
A data file (either .dat.gz or .csv.gz)


See Downloading IPUMS files below for more information about downloading
these files.
read_ipums_micro_chunked() and read_ipums_micro_list_chunked() differ
in their handling of extracts that contain multiple record types.
See Data structures below.
Note that Stata, SAS, and SPSS file formats are not supported by
ipumsr readers. Convert your extract to fixed-width or CSV format, or see
haven for help
loading these files."><meta property="og:image" content="https://tech.popdata.org/ipumsr/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ipumsr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.8.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ipums.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>IPUMS Data</h6></li>
    <li><a class="dropdown-item" href="../articles/ipums-read.html">Read IPUMS data</a></li>
    <li><a class="dropdown-item" href="../articles/value-labels.html">Value labels</a></li>
    <li><a class="dropdown-item" href="../articles/ipums-bigdata.html">Big IPUMS data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>IPUMS API</h6></li>
    <li><a class="dropdown-item" href="../articles/ipums-api.html">Introduction to the API</a></li>
    <li><a class="dropdown-item" href="../articles/ipums-api-micro.html">Microdata API requests</a></li>
    <li><a class="dropdown-item" href="../articles/ipums-api-nhgis.html">NHGIS API requests</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="external-link dropdown-item" href="https://ipums.org/exercises.shtml">Project-specific exercises</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipums/ipumsr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://forum.ipums.org" aria-label="IPUMS User Forum"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.ipums.org/" aria-label="IPUMS website"><span class="fa fa-globe"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Read data from an IPUMS microdata extract by chunk</h1>
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/main/R/micro_read_chunked.R" class="external-link"><code>R/micro_read_chunked.R</code></a></small>
      <div class="d-none name"><code>read_ipums_micro_chunked.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Read a microdata dataset downloaded from the IPUMS extract system in chunks.</p>
<p>Use these functions to read a file that is too large to store in memory
at a single time. The file is processed in chunks of a given size, with a
provided callback function applied to each chunk.</p>
<p>Two files are required to load IPUMS microdata extracts:</p><ul><li><p>A <a href="https://ddialliance.org/introduction-to-ddi" class="external-link">DDI codebook</a> file
(.xml) used to parse the extract's data file</p></li>
<li><p>A data file (either .dat.gz or .csv.gz)</p></li>
</ul><p>See <em>Downloading IPUMS files</em> below for more information about downloading
these files.</p>
<p><code>read_ipums_micro_chunked()</code> and <code>read_ipums_micro_list_chunked()</code> differ
in their handling of extracts that contain multiple record types.
See <em>Data structures</em> below.</p>
<p>Note that Stata, SAS, and SPSS file formats are not supported by
ipumsr readers. Convert your extract to fixed-width or CSV format, or see
<a href="https://haven.tidyverse.org/index.html" class="external-link">haven</a> for help
loading these files.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">read_ipums_micro_chunked</span><span class="op">(</span></span>
<span>  <span class="va">ddi</span>,</span>
<span>  <span class="va">callback</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  var_attrs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"val_labels"</span>, <span class="st">"var_label"</span>, <span class="st">"var_desc"</span><span class="op">)</span>,</span>
<span>  lower_vars <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">read_ipums_micro_list_chunked</span><span class="op">(</span></span>
<span>  <span class="va">ddi</span>,</span>
<span>  <span class="va">callback</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  var_attrs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"val_labels"</span>, <span class="st">"var_label"</span>, <span class="st">"var_desc"</span><span class="op">)</span>,</span>
<span>  lower_vars <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ddi">ddi<a class="anchor" aria-label="anchor" href="#arg-ddi"></a></dt>
<dd><p>Either a path to a DDI .xml file downloaded from
<a href="https://www.ipums.org/" class="external-link">IPUMS</a>, or an
<a href="ipums_ddi-class.html">ipums_ddi</a> object parsed by <code><a href="read_ipums_ddi.html">read_ipums_ddi()</a></code>. See
<em>Downloading IPUMS files</em> below.</p></dd>


<dt id="arg-callback">callback<a class="anchor" aria-label="anchor" href="#arg-callback"></a></dt>
<dd><p>An <a href="ipums_callback.html">ipums_callback</a> object, or a function
that will be converted to an <code>IpumsSideEffectCallback</code> object. Callback
functions should include both data (<code>x</code>) and position (<code>pos</code>) arguments.
See examples.</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Integer number of observations to
read per chunk. Higher values use more RAM, but
typically result in faster processing. Defaults to 10,000.</p></dd>


<dt id="arg-vars">vars<a class="anchor" aria-label="anchor" href="#arg-vars"></a></dt>
<dd><p>Names of variables to include in the output. Accepts a
vector of names or a <a href="selection_language.html">tidyselect selection</a>.
If <code>NULL</code>, includes all variables in the file.</p>
<p>For hierarchical data, the <code>RECTYPE</code> variable is always included even if
unspecified.</p></dd>


<dt id="arg-data-file">data_file<a class="anchor" aria-label="anchor" href="#arg-data-file"></a></dt>
<dd><p>Path to the data (.gz) file associated with
the provided <code>ddi</code> file. By default, looks for the data file in the same
directory as the DDI file. If the data file has been moved, specify
its location here.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical indicating whether to display IPUMS conditions and
progress information.</p></dd>


<dt id="arg-var-attrs">var_attrs<a class="anchor" aria-label="anchor" href="#arg-var-attrs"></a></dt>
<dd><p>Variable attributes from the DDI to add to the columns of
the output data. Defaults to all available attributes.
See <code><a href="set_ipums_var_attributes.html">set_ipums_var_attributes()</a></code> for more details.</p></dd>


<dt id="arg-lower-vars">lower_vars<a class="anchor" aria-label="anchor" href="#arg-lower-vars"></a></dt>
<dd><p>If reading a DDI from a file,
a logical indicating whether to convert variable names to lowercase.
Defaults to <code>FALSE</code> for consistency with IPUMS conventions.</p>
<p>This argument will be ignored if argument <code>ddi</code> is
an <a href="ipums_ddi-class.html">ipums_ddi</a> object. Use <code><a href="read_ipums_ddi.html">read_ipums_ddi()</a></code> to convert variable
names to lowercase when reading a DDI file.</p>
<p>Note that if reading in chunks from a .csv or
.csv.gz file, the callback function will be called <em>before</em> variable names
are converted to lowercase, and thus should reference uppercase variable
names.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Depends on the provided callback object. See <a href="ipums_callback.html">ipums_callback</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="data-structures">Data structures<a class="anchor" aria-label="anchor" href="#data-structures"></a></h2>


<p>Files from IPUMS projects that contain data for multiple types of records
(e.g. household records and person records) may be either rectangular
or hierarchical.</p>
<p>Rectangular data are transformed such that each row of data
represents only one type of record. For instance, each row will represent
a person record, and all household-level information for that person will
be included in the same row.</p>
<p>Hierarchical data have records of
different types interspersed in a single file. For instance, a household
record will be included in its own row followed by the person records
associated with that household.</p>
<p>Hierarchical data can be read in two different formats:</p><ul><li><p><code>read_ipums_micro_chunked()</code> reads each chunk of data into a
<code><a href="https://tibble.tidyverse.org/reference/tbl_df-class.html" class="external-link">tibble</a></code> where each row represents a single record,
regardless of record type. Variables that do not apply to a particular
record type will be filled with <code>NA</code> in rows of that record type. For
instance, a person-specific variable will be missing in all rows
associated with household records. The provided <code>callback</code> function should
therefore operate on a <code>tibble</code> object.</p></li>
<li><p><code>read_ipums_micro_list_chunked()</code> reads each chunk of data into a list of
<code>tibble</code> objects, where each list element contains
only one record type. Each list element is named with its corresponding
record type. The provided <code>callback</code> function should therefore operate
on a list object. In this case, the chunk size references the total
number of rows <em>across</em> record types, rather than in each
record type.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="downloading-ipums-files">Downloading IPUMS files<a class="anchor" aria-label="anchor" href="#downloading-ipums-files"></a></h2>



<p>You must download both the DDI codebook and the data file from the IPUMS
extract system to load the data into R. <code>read_ipums_micro_*()</code> functions
assume that the data file and codebook share a common base file name and
are present in the same directory. If this is not the case, provide a
separate path to the data file with the <code>data_file</code> argument.</p>
<p>If using the IPUMS extract interface:</p><ul><li><p>Download the data file by clicking <strong>Download .dat</strong> under
<strong>Download Data</strong>.</p></li>
<li><p>Download the DDI codebook by right clicking on the <strong>DDI</strong> link in the
<strong>Codebook</strong> column of the extract interface and selecting <strong>Save as...</strong>
(on Safari, you may have to select <strong>Download Linked File as...</strong>).
Be sure that the codebook is downloaded in .xml format.</p></li>
</ul><p>If using the IPUMS API:</p><ul><li><p>For supported collections, use <code><a href="download_extract.html">download_extract()</a></code> to download a completed
extract via the IPUMS API. This automatically downloads both the DDI
codebook and the data file from the extract and
returns the path to the codebook file.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="read_ipums_micro_yield.html">read_ipums_micro_yield()</a></code> for more flexible handling of large
IPUMS microdata files.</p>
<p><code><a href="read_ipums_micro.html">read_ipums_micro()</a></code> to read data from an IPUMS microdata extract.</p>
<p><code><a href="read_ipums_ddi.html">read_ipums_ddi()</a></code> to read metadata associated with an IPUMS microdata
extract.</p>
<p><code><a href="read_ipums_sf.html">read_ipums_sf()</a></code> to read spatial data from an IPUMS extract.</p>
<p><code><a href="ipums_list_files.html">ipums_list_files()</a></code> to list files in an IPUMS extract.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example codebook file</span></span></span>
<span class="r-in"><span><span class="va">cps_rect_ddi_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"cps_00157.xml"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function to extract Minnesota cases from CPS example</span></span></span>
<span class="r-in"><span><span class="co"># (This can also be accomplished by including case selections</span></span></span>
<span class="r-in"><span><span class="co"># in an extract definition)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Function must take `x` and `pos` to refer to data and row position,</span></span></span>
<span class="r-in"><span><span class="co"># respectively.</span></span></span>
<span class="r-in"><span><span class="va">filter_mn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pos</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">STATEFIP</span> <span class="op">==</span> <span class="fl">27</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initialize callback</span></span></span>
<span class="r-in"><span><span class="va">filter_mn_callback</span> <span class="op">&lt;-</span> <span class="va"><a href="ipums_callback.html">IpumsDataFrameCallback</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">filter_mn</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Process data in chunks, filtering to MN cases in each chunk</span></span></span>
<span class="r-in"><span><span class="fu">read_ipums_micro_chunked</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cps_rect_ddi_file</span>,</span></span>
<span class="r-in"><span>  callback <span class="op">=</span> <span class="va">filter_mn_callback</span>,</span></span>
<span class="r-in"><span>  chunk_size <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2,362 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     YEAR SERIAL MONTH     ASECWTH STATEFIP       PERNUM ASECWT INCTOT   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>962     82 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">1</span>598. 27<span style="color: #949494;"> [Minnesota]</span>      1  <span style="text-decoration: underline;">1</span>598. <span style="text-decoration: underline;">14</span>015    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>962     83 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">1</span>707. 27<span style="color: #949494;"> [Minnesota]</span>      1  <span style="text-decoration: underline;">1</span>707. <span style="text-decoration: underline;">16</span>552    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>962     84 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">1</span>790. 27<span style="color: #949494;"> [Minnesota]</span>      1  <span style="text-decoration: underline;">1</span>790.  <span style="text-decoration: underline;">6</span>375    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>962    122 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">3</span>603. 27<span style="color: #949494;"> [Minnesota]</span>      1  <span style="text-decoration: underline;">3</span>603. <span style="text-decoration: underline;">15</span>550    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>962    122 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">3</span>603. 27<span style="color: #949494;"> [Minnesota]</span>      2  <span style="text-decoration: underline;">3</span>603.     0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">1</span>962    122 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">3</span>603. 27<span style="color: #949494;"> [Minnesota]</span>      3  <span style="text-decoration: underline;">4</span>243.  <span style="text-decoration: underline;">3</span>443    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">1</span>962    122 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">3</span>603. 27<span style="color: #949494;"> [Minnesota]</span>      4  <span style="text-decoration: underline;">3</span>920.   255    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">1</span>962    122 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">3</span>603. 27<span style="color: #949494;"> [Minnesota]</span>      5  <span style="text-decoration: underline;">3</span>689.   135    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">1</span>962    857 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">1</span>832. 27<span style="color: #949494;"> [Minnesota]</span>      1  <span style="text-decoration: underline;">1</span>832.   624    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">1</span>962    857 3<span style="color: #949494;"> [March]</span>   <span style="text-decoration: underline;">1</span>832. 27<span style="color: #949494;"> [Minnesota]</span>      2  <span style="text-decoration: underline;">1</span>832.  <span style="text-decoration: underline;">3</span>600    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2,352 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Tabulate INCTOT average by state without storing full dataset in memory</span></span></span>
<span class="r-in"><span><span class="fu">read_ipums_micro_chunked</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">cps_rect_ddi_file</span>,</span></span>
<span class="r-in"><span>  callback <span class="op">=</span> <span class="va"><a href="ipums_callback.html">IpumsDataFrameCallback</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pos</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>          INCTOT <span class="op">=</span> <span class="fu"><a href="lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>            <span class="va">INCTOT</span>,</span></span>
<span class="r-in"><span>            <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Missing|N.I.U."</span>, <span class="va">.lbl</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">INCTOT</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>STATEFIP <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">STATEFIP</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>INCTOT_SUM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">INCTOT</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  chunk_size <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">STATEFIP</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>avg_inc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">INCTOT_SUM</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   STATEFIP     avg_inc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> Iowa           <span style="text-decoration: underline;">2</span>252.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> Minnesota      <span style="text-decoration: underline;">2</span>500.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> North Dakota   <span style="text-decoration: underline;">2</span>800.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> South Dakota   <span style="text-decoration: underline;">1</span>641.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> Wisconsin      <span style="text-decoration: underline;">2</span>733.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `x` will be a list when using `read_ipums_micro_list_chunked()`</span></span></span>
<span class="r-in"><span><span class="fu">read_ipums_micro_list_chunked</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"cps_00159.xml"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  callback <span class="op">=</span> <span class="va"><a href="ipums_callback.html">IpumsSideEffectCallback</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pos</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">PERSON</span><span class="op">)</span>, <span class="st">" persons and "</span>,</span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">HOUSEHOLD</span><span class="op">)</span>, <span class="st">" households in this chunk."</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  chunk_size <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "699 persons and 301 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "701 persons and 299 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "693 persons and 307 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "685 persons and 315 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "696 persons and 304 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "691 persons and 309 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "695 persons and 305 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "691 persons and 309 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "694 persons and 306 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "692 persons and 308 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "692 persons and 308 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "39 persons and 14 households in this chunk."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using the biglm package, you can even run a regression without storing</span></span></span>
<span class="r-in"><span><span class="co"># the full dataset in memory</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"biglm"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lm_results</span> <span class="op">&lt;-</span> <span class="fu">read_ipums_micro_chunked</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"cps_00160.xml"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va"><a href="ipums_callback.html">IpumsBiglmCallback</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="va">INCTOT</span> <span class="op">~</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">HEALTH</span>, <span class="co"># Model formula</span></span></span>
<span class="r-in"><span>      <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pos</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>            INCTOT <span class="op">=</span> <span class="fu"><a href="lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>              <span class="va">INCTOT</span>,</span></span>
<span class="r-in"><span>              <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Missing|N.I.U."</span>, <span class="va">.lbl</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="op">)</span>,</span></span>
<span class="r-in"><span>            HEALTH <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">HEALTH</span><span class="op">)</span></span></span>
<span class="r-in"><span>          <span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    chunk_size <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_results</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required namespace: biglm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Large data regression model: biglm(INCTOT ~ AGE + HEALTH, data, ...)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample size =  8194 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        Coef        (95%        CI)        SE      p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      25351.6183  21728.2210  28975.016 1811.6986 0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AGE                499.7783    427.5196    572.037   36.1293 0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HEALTHVery good  -2135.1060  -5431.8110   1161.599 1648.3525 0.1952</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HEALTHGood      -10480.2543 -14052.9835  -6907.525 1786.3646 0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HEALTHFair      -23091.1061 -28274.2254 -17907.987 2591.5596 0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HEALTHPoor      -34341.0066 -42611.9852 -26070.028 4135.4893 0.0000</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

