<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Value Labels in IPUMS data • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Value Labels in IPUMS data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ipumsr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.7.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/ipums.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>IPUMS Data</h6></li>
    <li><a class="dropdown-item" href="../articles/ipums-read.html">Read IPUMS data</a></li>
    <li><a class="dropdown-item" href="../articles/value-labels.html">Value labels</a></li>
    <li><a class="dropdown-item" href="../articles/ipums-bigdata.html">Big IPUMS data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>IPUMS API</h6></li>
    <li><a class="dropdown-item" href="../articles/ipums-api.html">Introduction to the API</a></li>
    <li><a class="dropdown-item" href="../articles/ipums-api-micro.html">Microdata API requests</a></li>
    <li><a class="dropdown-item" href="../articles/ipums-api-nhgis.html">NHGIS API requests</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="external-link dropdown-item" href="https://ipums.org/exercises.shtml">Project-specific exercises</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipums/ipumsr" aria-label="Go to ipumsr on GitHub"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://forum.ipums.org" aria-label="Go to the IPUMS User Forum"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.ipums.org/" aria-label="Go to ipums.org"><span class="fa fa-globe"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Value Labels in IPUMS data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/main/vignettes/value-labels.Rmd" class="external-link"><code>vignettes/value-labels.Rmd</code></a></small>
      <div class="d-none name"><code>value-labels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="ipums-variable-metadata">IPUMS variable metadata<a class="anchor" aria-label="anchor" href="#ipums-variable-metadata"></a>
</h2>
<p>IPUMS data come with three primary types of variable-level
metadata:</p>
<ul>
<li><p><strong><em>Variable labels</em></strong> are succinct labels
that serve as human-readable variable names (in contrast to more
esoteric column names).</p></li>
<li><p><strong><em>Variable descriptions</em></strong> are extended text
descriptions of the contents of a variable. These provide more
information about what a given variable measures.</p></li>
<li><p><strong><em>Value labels</em></strong> link particular data
values to more meaningful text labels. For instance, the
<code>HEALTH</code> variable may have data values including
<code>1</code> and <code>2</code>, but these are actually stand-ins for
“Excellent” and “Very good” health. This mapping would be contained in a
value-label pair that includes a value and its associated
label.</p></li>
</ul>
<p>The rest of this article will focus on value labels; for more about
variable labels and descriptions, see <code><a href="../reference/ipums_var_info.html">?ipums_var_info</a></code>.</p>
</div>
<div class="section level2">
<h2 id="value-labels">Value labels<a class="anchor" aria-label="anchor" href="#value-labels"></a>
</h2>
<p>ipumsr uses the <a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link"><code>labelled</code></a>
class from the <a href="https://haven.tidyverse.org" class="external-link">haven</a> package to handle value labels.</p>
<p>You can see this in the column data types when loading IPUMS data.
Note that <code>&lt;int+lbl&gt;</code> appears below <code>MONTH</code>
and <code>ASECFLAG</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tech.popdata.org/ipumsr/">ipumsr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span><span class="op">(</span><span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"cps_00160.xml"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cps</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10,883 × 5</span></span></span>
<span><span class="co">#&gt;     YEAR SERIAL MONTH       CPSID ASECFLAG </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>138 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>139 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>139 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>140 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>140 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>140 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>141 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>142 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>142 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>142 3<span style="color: #949494;"> [March]</span> 2.02<span style="color: #949494;">e</span>13 1<span style="color: #949494;"> [ASEC]</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10,873 more rows</span></span></span></code></pre></div>
<p>This indicates that the data contained in these columns are integers
but include value labels. You can use the function
<code><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">is.labelled()</a></code> to determine if a variable is indeed
labelled:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">is.labelled</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Some of the labels are actually printed inline alongside their data
values, but it can be easier to see them by isolating them:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Labels print when accessing the column</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;labelled&lt;integer&gt;[6]&gt;: Month</span></span>
<span><span class="co">#&gt; [1] 3 3 3 3 3 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value     label</span></span>
<span><span class="co">#&gt;      1   January</span></span>
<span><span class="co">#&gt;      2  February</span></span>
<span><span class="co">#&gt;      3     March</span></span>
<span><span class="co">#&gt;      4     April</span></span>
<span><span class="co">#&gt;      5       May</span></span>
<span><span class="co">#&gt;      6      June</span></span>
<span><span class="co">#&gt;      7      July</span></span>
<span><span class="co">#&gt;      8    August</span></span>
<span><span class="co">#&gt;      9 September</span></span>
<span><span class="co">#&gt;     10   October</span></span>
<span><span class="co">#&gt;     11  November</span></span>
<span><span class="co">#&gt;     12  December</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get labels alone</span></span>
<span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 2</span></span></span>
<span><span class="co">#&gt;      val lbl      </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 January  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 February </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 March    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 April    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 May      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 June     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 July     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 August   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 September</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 October  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 November </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 December</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="labelled-vs--factor">
<code>labelled</code> vs. <code>factor</code><a class="anchor" aria-label="anchor" href="#labelled-vs--factor"></a>
</h2>
<p>Base R already supports the linking of numeric data to categories
using its <code>factor</code> data type. While factors may be more
familiar, they were designed to support efficient calculations in linear
models, not as a human-readable labeling system for interpreting and
processing data.</p>
<p>Compared to factors, <code>labelled</code> vectors have two main
properties that make them more suitable for working with IPUMS data:</p>
<ul>
<li>They don’t require that all values be labelled</li>
<li>They don’t require values to be assigned to increasing integers
starting at 1</li>
</ul>
<p>Consider the case of the <code>AGE</code> variable. For many IPUMS
products, <code>AGE</code> provides a person’s age in years, but certain
special values have other interpretations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;labelled&lt;integer&gt;[6]&gt;: Age</span></span>
<span><span class="co">#&gt; [1] 54 54 52 38 15 38</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value               label</span></span>
<span><span class="co">#&gt;      0        Under 1 year</span></span>
<span><span class="co">#&gt;     90 90 (90+, 1988-2002)</span></span>
<span><span class="co">#&gt;     99                 99+</span></span></code></pre></div>
<p>As you can see, the 0 value represents all ages less than 1, and the
90 and 99 values actually represent ranges of ages. Coercing
<code>AGE</code> to a factor would convert all values of 0 to 1, because
factors always assign values starting at 1:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cps</span><span class="op">$</span><span class="va">AGE_FACTOR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">age0_factor</span> <span class="op">&lt;-</span> <span class="va">cps</span><span class="op">[</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">$</span><span class="va">AGE_FACTOR</span></span>
<span></span>
<span><span class="co"># The levels look the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">age0_factor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Under 1 year</span></span>
<span><span class="co">#&gt; 84 Levels: Under 1 year 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ... 99+</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># But the values have changed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age0_factor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>Additionally, because not all values exist in the data, high values,
like 85, 90, and 99 have been mapped to lower values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age85_factor</span> <span class="op">&lt;-</span> <span class="va">cps</span><span class="op">[</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span> <span class="op">==</span> <span class="fl">85</span>, <span class="op">]</span><span class="op">$</span><span class="va">AGE_FACTOR</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age85_factor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 82</span></span></code></pre></div>
<p>These different representations lead to inconsistencies in calculated
values:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 35.0226</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE_FACTOR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 35.94836</span></span></code></pre></div>
<div class="section level3">
<h3 id="cautions-regarding-labelled-variables">Cautions regarding <code>labelled</code> variables<a class="anchor" aria-label="anchor" href="#cautions-regarding-labelled-variables"></a>
</h3>
<p>While <code>labelled</code> variables provide the benefits described
above, they also present challenges.</p>
<p>For example, you may have noticed that <em>both</em> of the means
calculated above are suspect:</p>
<ul>
<li>In the case of <code>AGE_FACTOR</code>, the values have been
remapped during conversion and several are inconsistent with the
original data.</li>
<li>In the case of <code>AGE</code>, we have considered all people over
90 to be exactly 90, and all people over 99 to be exactly
99—<code>labelled</code> variables don’t ensure that calculations are
correct any more than factors do!</li>
</ul>
<p>Furthermore, many R functions ignore value labels or even actively
remove them from the data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;     val lbl      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Excellent</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Very good</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Good     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Fair     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Poor</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HEALTH2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="fl">3</span>, <span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">HEALTH2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 variables: val &lt;dbl&gt;, lbl &lt;chr&gt;</span></span></span></code></pre></div>
<p>So, <code>labelled</code> vectors are not intended for use throughout
the entire analysis process. Instead, they should be used during the
initial data preparation process to convert raw data into values that
are more meaningful. These can then be converted to other variable types
(often factors) for analysis.</p>
<p>Unfortunately, this isn’t a process that can typically be automated,
as it depends primarily on the research questions the data will be used
to address. However, ipumsr provides several functions to manipulate
value labels to make this process easier.</p>
</div>
</div>
<div class="section level2">
<h2 id="prepping-data-with-value-labels">Prepping data with value labels<a class="anchor" aria-label="anchor" href="#prepping-data-with-value-labels"></a>
</h2>
<div class="section level3">
<h3 id="convert-labelled-values-to-other-data-types">Convert labelled values to other data types<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that if you’re reading this article on the ipumsr
website, auto-generated links for the function &lt;code&gt;&lt;a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link"&gt;as_factor()&lt;/a&gt;&lt;/code&gt;
point to the &lt;a href="https://forcats.tidyverse.org/" class="external-link"&gt;forcats&lt;/a&gt; package, but the documentation for
&lt;code&gt;&lt;a href="https://haven.tidyverse.org/reference/as_factor.html" class="external-link"&gt;haven::as_factor.labelled()&lt;/a&gt;&lt;/code&gt; is more informative for working
with labelled variables.&lt;/p&gt;'><sup>1</sup></a><a class="anchor" aria-label="anchor" href="#convert-labelled-values-to-other-data-types"></a>
</h3>
<p>Use <code><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor()</a></code> once labels have the correct categories
and need no further manipulation. For instance, <code>MONTH</code>
already has sensible categories, so we can convert it to a factor right
away:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 2</span></span></span>
<span><span class="co">#&gt;      val lbl      </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 January  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 February </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 March    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 April    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 May      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 June     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 July     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 August   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 September</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 October  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 November </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 December</span></span>
<span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor()</a></code> can also convert all <code>labelled</code>
variables in a data frame to factors at once. If you prefer to work with
factors, you can do this conversion immediately after loading data, and
then prepare these variables using techniques you would use for
factors.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... further preparation of variables as factors</span></span></code></pre></div>
<p>If you prefer to handle these variables in <code>labelled</code>
format, you can use the <code>lbl_*</code> helpers first, then call
<code><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor()</a></code> on the entire data frame.</p>
<p>Some variables may be more appropriate to use as numeric values
rather than factors. In these cases, you can simply remove the labels
with <code><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels()</a></code>.</p>
<p><code>INCTOT</code>, which measures personal income, fits this
description:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inctot_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">inctot_num</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "double"</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">inctot_num</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 variables: val &lt;dbl&gt;, lbl &lt;chr&gt;</span></span></span></code></pre></div>
<p>Note that labelled values are not generally intended to be
interpreted as numeric values, so <code><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels()</a></code> should only
be used after labels have been properly handled. For example, in
<code>INCTOT</code>, labelled values used to identify missing values are
encoded with large numbers:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;         val lbl                      </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 999<span style="text-decoration: underline;">999</span>998 Missing. (1962-1964 only)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 999<span style="text-decoration: underline;">999</span>999 N.I.U.</span></span></code></pre></div>
<p>Treating these as legitimate observations will significantly skew any
calculations with this variable if not first converted to
<code>NA</code>.</p>
</div>
<div class="section level3">
<h3 id="create-missing-values-based-on-value-labels">Create missing values based on value labels<a class="anchor" aria-label="anchor" href="#create-missing-values-based-on-value-labels"></a>
</h3>
<p>Many IPUMS variables use labelled values to identify missing data.
This allows for more detail about why certain observations were missing
than would be available were values loaded as <code>NA</code>.</p>
<p>As we saw with <code>INCTOT</code>, value labels were used to
identify two types of missing data: those that are legitimately missing
and those that are not in the universe of observations.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;         val lbl                      </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 999<span style="text-decoration: underline;">999</span>998 Missing. (1962-1964 only)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 999<span style="text-decoration: underline;">999</span>999 N.I.U.</span></span></code></pre></div>
<p>To convert one or both of these labelled values to <code>NA</code>,
use <code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code>. To use <code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code>, you must
supply a function to handle the conversion. The function should take a
value-label pair as its input and output <code>TRUE</code> for those
pairs whose values should be converted to <code>NA</code>.</p>
<div class="section level4">
<h4 id="syntax">Syntax for value label functions<a class="anchor" aria-label="anchor" href="#syntax"></a>
</h4>
<p>Several <code>lbl_*</code> helper functions, including
<code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code>, require a user-defined function to handle
recoding of value-label pairs. ipumsr provides a syntax to easily
reference the values and labels in this user-defined function:</p>
<ul>
<li>The <code>.val</code> argument references the <em>values</em>
</li>
<li>The <code>.lbl</code> argument references the <em>labels</em>
</li>
</ul>
<p>For instance, to convert all values equal to <code>999999999</code>
to <code>NA</code>, we can provide a function that uses the
<code>.val</code> argument:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to NA using function that returns TRUE for all labelled values equal to 99999999</span></span>
<span><span class="va">inctot_na</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span></span>
<span>  <span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">.val</span>, <span class="va">.lbl</span><span class="op">)</span> <span class="va">.val</span> <span class="op">==</span> <span class="fl">999999999</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All 99999999 values have been converted to NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">inctot_na</span> <span class="op">==</span> <span class="fl">999999999</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># And the label has been removed:</span></span>
<span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">inctot_na</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;         val lbl                      </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 999<span style="text-decoration: underline;">999</span>998 Missing. (1962-1964 only)</span></span></code></pre></div>
<p>We could achieve the same result by referencing the labels
themselves:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to NA for labels that contain "N.I.U."</span></span>
<span><span class="va">inctot_na2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span></span>
<span>  <span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">.val</span>, <span class="va">.lbl</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"N.I.U."</span>, <span class="va">.lbl</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">inctot_na2</span> <span class="op">==</span> <span class="va">inctot_na</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>You can also specify the function using a one-sided formula:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="op">~</span> <span class="va">.val</span> <span class="op">==</span> <span class="fl">999999999</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code>.val</code> only refers to <em>labelled</em>
values—unlabelled values are not affected:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="op">~</span> <span class="va">.val</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unlabelled values greater than the cutoff are still present:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7501</span></span></code></pre></div>
<p>To convert unlabelled values to <code>NA</code>, use
<code><a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link">dplyr::na_if()</a></code> instead.</p>
</div>
</div>
<div class="section level3">
<h3 id="relabel-values">Relabel values<a class="anchor" aria-label="anchor" href="#relabel-values"></a>
</h3>
<p><code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code> can be used to create new value-label
pairs, often to recombine existing labels into more general categories.
It takes a two-sided formula to handle the relabeling:</p>
<ul>
<li>On the left-hand side, use the <code><a href="../reference/lbl.html">lbl()</a></code> helper to define a
new value-label pair.</li>
<li>On the right-hand side, provide a function that returns
<code>TRUE</code> for those value-label pairs that should be relabelled
with the new value-label pair from the left-hand side.</li>
</ul>
<p>The function again uses the <code>.val</code> and <code>.lbl</code>
<a href="#syntax">syntax</a> mentioned above to refer to values and
labels, respectively.</p>
<p>For instance, we could reclassify the categories in
<code>MIGRATE1</code> such that all migration within a state is captured
in a single category:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;     val lbl                                 </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 NIU                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Same house                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2 Different house, place not reported </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     3 Moved within county                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     4 Moved within state, different county</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     5 Moved between states                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     6 Abroad                              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     9 Unknown</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_relabel.html">lbl_relabel</a></span><span class="op">(</span></span>
<span>  <span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"NIU / Missing / Unknown"</span><span class="op">)</span> <span class="op">~</span> <span class="va">.val</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Stayed in state"</span><span class="op">)</span> <span class="op">~</span> <span class="va">.val</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;     val lbl                    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 NIU / Missing / Unknown</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Stayed in state        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     5 Moved between states   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     6 Abroad</span></span></code></pre></div>
<p>Many IPUMS variables include detailed labels that are grouped
together into more general categories. These are often encoded with
multi-digit values, where the starting digit refers to the larger
category.</p>
<p>For instance, the <code>EDUC</code> variable contains categories for
individual grades as well as categories for multiple grade groups:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 2</span></span></span>
<span><span class="co">#&gt;      val lbl                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     0 NIU or no schooling </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 NIU or blank        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2 None or preschool   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    10 Grades 1, 2, 3, or 4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    11 Grade 1             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    12 Grade 2             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    13 Grade 3             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    14 Grade 4             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    20 Grades 5 or 6       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    21 Grade 5             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    22 Grade 6             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    30 Grades 7 or 8       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>    31 Grade 7             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>    32 Grade 8             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>    40 Grade 9</span></span></code></pre></div>
<p>You could use <code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code> to collapse the detailed
categories into the more general ones, but you would have to define new
value labels for all the categories. Instead, you could use
<code><a href="../reference/lbl_relabel.html">lbl_collapse()</a></code>.</p>
<p><code><a href="../reference/lbl_relabel.html">lbl_collapse()</a></code> uses a function that takes
<code>.val</code> and <code>.lbl</code> <a href="#syntax">arguments</a>
and returns the new value each input value should be assigned to. The
label of the lowest original value is used for each collapsed group. To
group by the tens digit, use the integer division operator
<code>%/%</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># %/% refers to integer division, which divides but discards the remainder</span></span>
<span><span class="fl">10</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">10</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="fl">11</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">10</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to groups by tens digit</span></span>
<span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_relabel.html">lbl_collapse</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span>, <span class="op">~</span> <span class="va">.val</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 2</span></span></span>
<span><span class="co">#&gt;      val lbl                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     0 NIU or no schooling </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 Grades 1, 2, 3, or 4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2 Grades 5 or 6       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     3 Grades 7 or 8       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     4 Grade 9             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5 Grade 10            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     6 Grade 11            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     7 Grade 12            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     8 1 year of college   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     9 2 years of college  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    10 3 years of college  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    11 4 years of college  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>    12 5+ years of college </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>    99 Missing/Unknown</span></span></code></pre></div>
<div class="section level4">
<h4 id="relabeling-caveats">Relabeling caveats<a class="anchor" aria-label="anchor" href="#relabeling-caveats"></a>
</h4>
<p>It is always worth checking that the new labels make sense based on
your research question. For instance, in the above example, both
<code>"12th grade, no diploma"</code> and
<code>"High school diploma or equivalent"</code> are collapsed to a
single group as they both have values in the 70s. This may be suitable
for your purposes, but for more control, it is best to use
<code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code>.</p>
<p>Note that <code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code> and <code><a href="../reference/lbl_relabel.html">lbl_collapse()</a></code>
only operate on <em>labelled</em> values, and are therefore designed for
use with fully <code>labelled</code> vectors. That is, if you attempt to
relabel a vector that has some unlabelled values, they will be converted
to <code>NA</code>.</p>
<p>To avoid this, you can add labels for all values using
<code><a href="../reference/lbl_add.html">lbl_add_vals()</a></code> before relabeling (see <a href="#lbl_add">below</a>). In general, this shouldn’t be necessary, as
most partially-labelled vectors only include labels with ancillary
information, like missing value indicators. These can typically be
handled by other helpers, like <code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code>, without
requiring relabeling.</p>
</div>
</div>
<div class="section level3">
<h3 id="remove-unused-value-labels">Remove unused value labels<a class="anchor" aria-label="anchor" href="#remove-unused-value-labels"></a>
</h3>
<p>Some variables may contain labels for values that don’t appear in the
data. Unused levels still appear in factor representations of these
variables, so it is often beneficial to remove them with
<code><a href="../reference/lbl_clean.html">lbl_clean()</a></code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 75 × 2</span></span></span>
<span><span class="co">#&gt;      val lbl                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Alabama             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Alaska              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     4 Arizona             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     5 Arkansas            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     6 California          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     8 Colorado            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     9 Connecticut         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    10 Delaware            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    11 District of Columbia</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    12 Florida             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 65 more rows</span></span></span>
<span><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="fu"><a href="../reference/lbl_clean.html">lbl_clean</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;     val lbl         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    19 Iowa        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    27 Minnesota   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    38 North Dakota</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    46 South Dakota</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    55 Wisconsin</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lbl_add">Add new labels<a class="anchor" aria-label="anchor" href="#lbl_add"></a>
</h3>
<p>As mentioned above, value labels are intended to be used as an
intermediate data structure for preparing newly-imported data. As such,
you’re not likely to need to add new labels, but if you do, use
<code><a href="../reference/lbl_add.html">lbl_add()</a></code>, <code><a href="../reference/lbl_add.html">lbl_add_vals()</a></code>, or
<code><a href="../reference/lbl_define.html">lbl_define()</a></code>.</p>
<p><code><a href="../reference/lbl_add.html">lbl_add()</a></code> takes an arbitrary number of
<code><a href="../reference/lbl.html">lbl()</a></code> placeholders that will be added to a given
<code>labelled</code> vector:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">labelled</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">105</span>, <span class="fl">990</span>, <span class="fl">999</span>, <span class="fl">230</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Unknown` <span class="op">=</span> <span class="fl">990</span>, NIU <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/lbl_add.html">lbl_add</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"$100"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">105</span>, <span class="st">"$105"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">200</span>, <span class="st">"$200"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">230</span>, <span class="st">"$230"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;labelled&lt;double&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1] 100 200 105 990 999 230</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value   label</span></span>
<span><span class="co">#&gt;    100    $100</span></span>
<span><span class="co">#&gt;    105    $105</span></span>
<span><span class="co">#&gt;    200    $200</span></span>
<span><span class="co">#&gt;    230    $230</span></span>
<span><span class="co">#&gt;    990 Unknown</span></span>
<span><span class="co">#&gt;    999     NIU</span></span></code></pre></div>
<p><code><a href="../reference/lbl_add.html">lbl_add_vals()</a></code> adds labels for all unlabelled values in
a <code>labelled</code> vector with an optional labeller function. (This
can be useful if you wish to operate on a partially labelled vector with
a function that requires labelled input, like
<code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code>.)</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `.` refers to each label value</span></span>
<span><span class="fu"><a href="../reference/lbl_add.html">lbl_add_vals</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"$"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;labelled&lt;double&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1] 100 200 105 990 999 230</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value   label</span></span>
<span><span class="co">#&gt;    100    $100</span></span>
<span><span class="co">#&gt;    105    $105</span></span>
<span><span class="co">#&gt;    200    $200</span></span>
<span><span class="co">#&gt;    230    $230</span></span>
<span><span class="co">#&gt;    990 Unknown</span></span>
<span><span class="co">#&gt;    999     NIU</span></span></code></pre></div>
<p><code><a href="../reference/lbl_define.html">lbl_define()</a></code> makes a <code>labelled</code> vector out of
an unlabelled one. Use the same syntax as is used for
<code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code> to define new labels based on the unlabelled
values:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">16</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">22</span>, <span class="fl">25</span>, <span class="fl">27</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Group age values into two label groups.</span></span>
<span><span class="co"># Values not captured by the right hand side functions remain unlabelled</span></span>
<span><span class="fu"><a href="../reference/lbl_define.html">lbl_define</a></span><span class="op">(</span></span>
<span>  <span class="va">age</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Pre-college age"</span><span class="op">)</span> <span class="op">~</span> <span class="va">.val</span> <span class="op">&lt;</span> <span class="fl">18</span>,</span>
<span>  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"College age"</span><span class="op">)</span> <span class="op">~</span> <span class="va">.val</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">.val</span> <span class="op">&lt;=</span> <span class="fl">22</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;labelled&lt;double&gt;[8]&gt;</span></span>
<span><span class="co">#&gt; [1]  1  1  1  2  2  2 25 27</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Labels:</span></span>
<span><span class="co">#&gt;  value           label</span></span>
<span><span class="co">#&gt;      1 Pre-college age</span></span>
<span><span class="co">#&gt;      2     College age</span></span></code></pre></div>
<p>Once all labelled variables have been appropriately converted to
factors or numeric values, the data can move forward in the processing
pipeline.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-resources">Other resources<a class="anchor" aria-label="anchor" href="#other-resources"></a>
</h2>
<p>The <a href="https://haven.tidyverse.org" class="external-link">haven</a> package, which underlies ipumsr’s handling
of value labels, provides more details on the <code>labelled</code>
class. See <code><a href="https://haven.tidyverse.org/articles/semantics.html" class="external-link">vignette("semantics", package = "haven")</a></code>.</p>
<p>The <a href="https://larmarange.github.io/labelled/" class="external-link">labelled</a> package provides other methods for
manipulating value labels, some of which overlap those provided by
ipumsr.</p>
<p>The <a href="https://juba.github.io/questionr/" class="external-link">questionr</a> package includes functions for exploring
<code>labelled</code> variables. In particular, the functions
<code>describe</code>, <code>freq</code> and <code>lookfor</code> all
print out to console information about the variable using the value
labels.</p>
<p>Finally, the <a href="https://cran.r-project.org/package=foreign" class="external-link">foreign</a> and <a href="https://cran.r-project.org/package=prettyR" class="external-link">prettyR</a> packages
don’t use the <code>labelled</code> class, but provide similar
functionality for handling value labels, which could be adapted for use
with <code>labelled</code> vectors.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
